<!DOCTYPE HTML>
<html lang="en">

<head>
<title>embr - vbo test</title>
<meta charset="utf-8">
<style type="text/css">

body {
  margin: 0; padding: 0;
}
#glcanvas {
  position: absolute;
  top: 0px;
  left: 0px;
  width: 100%;
  height: 100%;
}

</style>
<script type="text/javascript" src="../src/embr.js"></script>
<script type="text/javascript" src="../lib/gl-matrix.js"></script>
</head>

<body onload="init()">
<script type="text/javascript">

var vsh = [
  "uniform mat4 mvp;",
  "attribute vec4 position;",
  "void main(){",
    "gl_Position = mvp * position;",
  "}"
].join("\n");

var fsh = [
  "#ifdef GL_ES",
    "precision highp float;",
  "#endif",
  "uniform vec4 color;",
  "void main(){",
    "gl_FragColor = color;",
  "}"
].join("\n");

function init(){
  var canvas = document.getElementById("glcanvas");
  var gl = canvas.getContext("experimental-webgl");

  // Do this first
  Embr.setContext(Embr.wrapContextWithErrorChecks(gl));

  var prog = new Embr.Program(vsh, fsh).link();
  var line = new Embr.Vbo(gl.LINE_STRIP)
    .setAttr("position", { size: 4 })
    .setProg(prog);

  var points = [];
  document.addEventListener("mousemove", function(e){
    points.push(e.x, e.y, 0, 1);
    line.setAttr("position", { data: points });
  });

  function draw(){
    gl.clearColor(0, 0, 0, 1);
    gl.clear(gl.DEPTH_BUFFER_BIT | gl.COLOR_BUFFER_BIT);

    prog.use({
      mvp: mat4.ortho(0, canvas.width, canvas.height, 0, -1, 1),
      color: [1, 1, 1, 1]
    });
    line.draw();
  }

  function resize(){
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
    gl.viewport(0, 0, canvas.width, canvas.height);
  }
  window.addEventListener("resize", resize);
  resize();

  setInterval(draw, 1000 / 30);
}

</script>
<canvas id="glcanvas">
Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
</canvas>
</body>
</html>
