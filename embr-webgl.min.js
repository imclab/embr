var Embr=Embr!==void 0?Embr:{};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
Embr.run=function(b,c){var e=null;try{e=b.getContext("experimental-webgl")}catch(d){console.error(d)}if(e){console.log(["EMBR made a GL context!",e.getParameter(e.VERSION),e.getParameter(e.VENDOR),e.getParameter(e.RENDERER),e.getParameter(e.SHADING_LANGUAGE_VERSION)].join(" | "));c.gl=e;c.width=b.width=b.clientWidth;c.height=b.height=b.clientHeight;e.viewport(0,0,c.width,c.height);var a=null;c.framerate=function(f){a!==null&&clearInterval(a);f!==0&&(a=setInterval(function(){c._step()},1E3/f))};if(c.init)try{c.init()}catch(f){console.error("Exception caught in init: "+
f)}var p=0,k=Date.now(),h=!0;c._step=function(){if(c.step){c.frameid=p;c.frametime=(Date.now()-k)/1E3;try{c.step()}catch(a){console.error("Exception caught in step: "+a)}h=!0;p++}};c._draw=function(){if(c.draw&&h){try{c.draw()}catch(a){console.error("Exception caught in draw: "+a)}h=!1}window.requestAnimationFrame(c._draw,b)};c._step();c._draw();return c}};
(function(){function b(a,f,c){this.x=a;this.y=f;this.z=c}function c(a,f){this.x=a;this.y=f}function e(a,f,c,e){this.x=a;this.y=f;this.z=c;this.w=e}function d(){this.reset()}b.prototype.set=function(a,f,c){this.x=a;this.y=f;this.z=c;return this};b.prototype.setVec3=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};b.prototype.cross2=function(a,f){var c=a.x,e=a.y,d=a.z,b=f.x,j=f.y,m=f.z;this.x=e*m-d*j;this.y=d*b-c*m;this.z=c*j-e*b;return this};b.prototype.cross=function(a){return this.cross2(this,
a)};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};b.prototype.add2=function(a,f){this.x=a.x+f.x;this.y=a.y+f.y;this.z=a.z+f.z;return this};b.prototype.added2=function(a,f){return new b(a.x+f.x,a.y+f.y,a.z+f.z)};b.prototype.add=function(a){return this.add2(this,a)};b.prototype.added=function(a){return this.added2(this,a)};b.prototype.sub2=function(a,f){this.x=a.x-f.x;this.y=a.y-f.y;this.z=a.z-f.z;return this};b.prototype.subbed2=function(a,f){return new b(a.x-f.x,a.y-f.y,a.z-
f.z)};b.prototype.sub=function(a){return this.sub2(this,a)};b.prototype.subbed=function(a){return this.subbed2(this,a)};b.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};b.prototype.scaled=function(a){return new b(this.x*a,this.y*a,this.z*a)};b.prototype.lerp=function(a,f){this.x+=(a.x-this.x)*f;this.y+=(a.y-this.y)*f;this.z+=(a.z-this.z)*f;return this};b.prototype.lerped=function(a,f){return new b(this.x+(a.x-this.x)*f,this.y+(a.y-this.y)*f,this.z+(a.z-this.z)*f)};b.prototype.length=
function(){var a=this.x,f=this.y,c=this.z;return Math.sqrt(a*a+f*f+c*c)};b.prototype.lengthSquared=function(){var a=this.x,f=this.y,c=this.z;return a*a+f*f+c*c};b.prototype.normalize=function(){return this.scale(1/this.length())};b.prototype.normalized=function(){return this.dup().normalize()};b.prototype.dup=function(){return new b(this.x,this.y,this.z)};b.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z};c.prototype.set=function(a,f){this.x=a;this.y=f;return this};
c.prototype.setVec2=function(a){this.x=a.x;this.y=a.y;return this};c.prototype.dot=function(a){return this.x*a.x+this.y*a.y};c.prototype.add2=function(a,f){this.x=a.x+f.x;this.y=a.y+f.y;return this};c.prototype.added2=function(a,f){return new c(a.x+f.x,a.y+f.y)};c.prototype.add=function(a){return this.add2(this,a)};c.prototype.added=function(a){return this.added2(this,a)};c.prototype.sub2=function(a,f){this.x=a.x-f.x;this.y=a.y-f.y;return this};c.prototype.subbed2=function(a,f){return new c(a.x-f.x,
a.y-f.y)};c.prototype.sub=function(a){return this.sub2(this,a)};c.prototype.subbed=function(a){return this.subbed2(this,a)};c.prototype.scale=function(a){this.x*=a;this.y*=a;return this};c.prototype.scaled=function(a){return new c(this.x*a,this.y*a)};c.prototype.lerp=function(a,f){this.x+=(a.x-this.x)*f;this.y+=(a.y-this.y)*f;return this};c.prototype.lerped=function(a,f){return new c(this.x+(a.x-this.x)*f,this.y+(a.y-this.y)*f)};c.prototype.length=function(){var a=this.x,f=this.y;return Math.sqrt(a*
a+f*f)};c.prototype.lengthSquared=function(){var a=this.x,f=this.y;return a*a+f*f};c.prototype.normalize=function(){return this.scale(1/this.length())};c.prototype.normalized=function(){return this.dup().normalize()};c.prototype.dup=function(){return new c(this.x,this.y)};c.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y};e.prototype.set=function(a,f,c,e){this.x=a;this.y=f;this.z=c;this.w=e;return this};e.prototype.setVec4=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;
return this};e.prototype.dup=function(){return new e(this.x,this.y,this.z,this.w)};e.prototype.toVec3=function(){return new b(this.x,this.y,this.z)};d.prototype.set4x4r=function(a,f,c,e,d,b,j,m,g,o,s,l,r,n,q,v){this.a11=a;this.a12=f;this.a13=c;this.a14=e;this.a21=d;this.a22=b;this.a23=j;this.a24=m;this.a31=g;this.a32=o;this.a33=s;this.a34=l;this.a41=r;this.a42=n;this.a43=q;this.a44=v;return this};d.prototype.reset=function(){this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};d.prototype.mul2=
function(a,c){var e=a.a11,d=a.a12,b=a.a13,i=a.a14,j=a.a21,m=a.a22,g=a.a23,o=a.a24,s=a.a31,l=a.a32,r=a.a33,n=a.a34,q=a.a41,v=a.a42,t=a.a43,w=a.a44,u=c.a11,A=c.a12,y=c.a13,D=c.a14,E=c.a21,z=c.a22,F=c.a23,B=c.a24,C=c.a31,G=c.a32,x=c.a33,H=c.a34,I=c.a41,J=c.a42,K=c.a43,L=c.a44;this.a11=e*u+d*E+b*C+i*I;this.a12=e*A+d*z+b*G+i*J;this.a13=e*y+d*F+b*x+i*K;this.a14=e*D+d*B+b*H+i*L;this.a21=j*u+m*E+g*C+o*I;this.a22=j*A+m*z+g*G+o*J;this.a23=j*y+m*F+g*x+o*K;this.a24=j*D+m*B+g*H+o*L;this.a31=s*u+l*E+r*C+n*I;this.a32=
s*A+l*z+r*G+n*J;this.a33=s*y+l*F+r*x+n*K;this.a34=s*D+l*B+r*H+n*L;this.a41=q*u+v*E+t*C+w*I;this.a42=q*A+v*z+t*G+w*J;this.a43=q*y+v*F+t*x+w*K;this.a44=q*D+v*B+t*H+w*L;return this};d.prototype.mul=function(a){return this.mul2(this,a)};d.prototype.mul4x4r=function(a,c,e,d,b,i,j,m,g,o,s,l,r,n,q,v){var t=this.a11,w=this.a12,u=this.a13,A=this.a14,y=this.a21,D=this.a22,E=this.a23,z=this.a24,F=this.a31,B=this.a32,C=this.a33,G=this.a34,x=this.a41,H=this.a42,I=this.a43,J=this.a44;this.a11=t*a+w*b+u*g+A*r;this.a12=
t*c+w*i+u*o+A*n;this.a13=t*e+w*j+u*s+A*q;this.a14=t*d+w*m+u*l+A*v;this.a21=y*a+D*b+E*g+z*r;this.a22=y*c+D*i+E*o+z*n;this.a23=y*e+D*j+E*s+z*q;this.a24=y*d+D*m+E*l+z*v;this.a31=F*a+B*b+C*g+G*r;this.a32=F*c+B*i+C*o+G*n;this.a33=F*e+B*j+C*s+G*q;this.a34=F*d+B*m+C*l+G*v;this.a41=x*a+H*b+I*g+J*r;this.a42=x*c+H*i+I*o+J*n;this.a43=x*e+H*j+I*s+J*q;this.a44=x*d+H*m+I*l+J*v;return this};d.prototype.rotate=function(a,c,e,d){var b=Math.sin(a),a=Math.cos(a);this.mul4x4r(c*c*(1-a)+a,c*e*(1-a)-d*b,c*d*(1-a)+e*b,
0,e*c*(1-a)+d*b,e*e*(1-a)+a,e*d*(1-a)-c*b,0,c*d*(1-a)-e*b,e*d*(1-a)+c*b,d*d*(1-a)+a,0,0,0,0,1);return this};d.prototype.translate=function(a,c,e){this.mul4x4r(1,0,0,a,0,1,0,c,0,0,1,e,0,0,0,1);return this};d.prototype.scale=function(a,c,e){this.mul4x4r(a,0,0,0,0,c,0,0,0,0,e,0,0,0,0,1);return this};d.prototype.lookAt=function(a,c,e,d,h,i,j,m,g){d=(new b(a-d,c-h,e-i)).normalize();j=(new b(j,m,g)).cross(d).normalize();m=d.dup().cross(j).normalize();this.mul4x4r(j.x,j.y,j.z,0,m.x,m.y,m.z,0,d.x,d.y,d.z,
0,0,0,0,1);this.translate(-a,-c,-e);return this};d.prototype.frustum=function(a,c,e,d,b,i){this.mul4x4r((b+b)/(c-a),0,(c+a)/(c-a),0,0,(b+b)/(d-e),(d+e)/(d-e),0,0,0,(i+b)/(b-i),2*i*b/(b-i),0,0,-1,0);return this};d.prototype.perspective=function(a,c,e,d){a=1/Math.tan(a*Math.PI/360);this.mul4x4r(a/c,0,0,0,0,a,0,0,0,0,(d+e)/(e-d),2*e*d/(e-d),0,0,-1,0);return this};d.prototype.ortho=function(a,c,e,d,b,i){this.mul4x4r(2/(c-a),0,0,(c+a)/(a-c),0,2/(d-e),0,(d+e)/(e-d),0,0,2/(b-i),(i+b)/(b-i),0,0,0,1);return this};
d.prototype.invert=function(){var a=this.a11,c=this.a12,e=this.a13,d=this.a14,b=this.a21,i=this.a22,j=this.a23,m=this.a24,g=this.a31,o=this.a32,s=this.a33,l=this.a34,r=this.a41,n=this.a42,q=this.a43,v=this.a44,t=a*i-c*b,w=a*j-e*b,u=a*m-d*b,A=c*j-e*i,y=c*m-d*i,D=e*m-d*j,E=g*n-o*r,z=g*q-s*r,F=g*v-l*r,B=o*q-s*n,C=o*v-l*n,G=s*v-l*q,x=1/(t*G-w*C+u*B+A*F-y*z+D*E);this.a11=(+i*G-j*C+m*B)*x;this.a12=(-c*G+e*C-d*B)*x;this.a13=(+n*D-q*y+v*A)*x;this.a14=(-o*D+s*y-l*A)*x;this.a21=(-b*G+j*F-m*z)*x;this.a22=(+a*
G-e*F+d*z)*x;this.a23=(-r*D+q*u-v*w)*x;this.a24=(+g*D-s*u+l*w)*x;this.a31=(+b*C-i*F+m*E)*x;this.a32=(-a*C+c*F-d*E)*x;this.a33=(+r*y-n*u+v*t)*x;this.a34=(-g*y+o*u-l*t)*x;this.a41=(-b*B+i*z-j*E)*x;this.a42=(+a*B-c*z+e*E)*x;this.a43=(-r*A+n*w-q*t)*x;this.a44=(+g*A-o*w+s*t)*x;return this};d.prototype.transpose=function(){var a=this.a12,c=this.a13,e=this.a14,d=this.a21,b=this.a22,i=this.a23,j=this.a24,m=this.a31,g=this.a32,o=this.a33,s=this.a34,l=this.a41,r=this.a42,n=this.a43,q=this.a44;this.a11=this.a11;
this.a12=d;this.a13=m;this.a14=l;this.a21=a;this.a22=b;this.a23=g;this.a24=r;this.a31=c;this.a32=i;this.a33=o;this.a34=n;this.a41=e;this.a42=j;this.a43=s;this.a44=q;return this};d.prototype.mulVec3=function(a){var c=a.x,e=a.y,a=a.z;return new b(this.a14+this.a11*c+this.a12*e+this.a13*a,this.a24+this.a21*c+this.a22*e+this.a23*a,this.a34+this.a31*c+this.a32*e+this.a33*a)};d.prototype.mulVec4=function(a){var c=a.x,d=a.y,b=a.z,a=a.w;return new e(this.a14*a+this.a11*c+this.a12*d+this.a13*b,this.a24*a+
this.a21*c+this.a22*d+this.a23*b,this.a34*a+this.a31*c+this.a32*d+this.a33*b,this.a44*a+this.a41*c+this.a42*d+this.a43*b)};d.prototype.dup=function(){var a=new d;a.set4x4r(this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44);return a};d.prototype.toFloat32Array=function(){return new Float32Array([this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,
this.a24,this.a34,this.a44])};d.prototype.debugString=function(){for(var a=[this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44],c=[0,0,0,0],e=0;e<16;++e){a[e]+="";var d=a[e].length,b=e&3;c[b]<d&&(c[b]=d)}b="";for(e=0;e<16;++e){d=a[e].length;for(d=c[e&3]-d;d--;)b+=" ";b+=a[e]+((e&3)===3?"\n":"  ")}return b};Embr.Vec2=c;Embr.Vec3=b;Embr.Vec4=e;Embr.Mat4=d})();
Embr.Util=function(){var b=null;return{glCheckErr:function(c,e){var d=c.getError();if(d!==c.NO_ERROR){if(b===null){b={};for(var a in c)typeof c[a]=="number"&&(b[c[a]]=a)}throw e+" ("+b[d]+")";}}}}();Embr.rand=function(b){return Math.random()*b};Embr.rand2=function(b,c){return b+Math.random()*(c-b)};Embr.randSym=function(b){return b*2*Math.random()-b};
(function(){Embr.kPI=Math.PI;Embr.kPI2=Math.PI/2;Embr.kPI4=Math.PI/4;var b=Embr.k2PI=Math.PI*2;Embr.randVec3=function(c){var e=Math.random()*b,d=Math.random()*2-1,a=Math.sqrt(1-d*d);return new Embr.Vec3(a*Math.cos(e)*c,a*Math.sin(e)*c,d*c)}})();
Embr.Quat=function(){function b(){this.reset()}var c=Math.pow(2,-24);b.prototype.set=function(c,d,a,b){this.x=c;this.y=d;this.z=a;this.w=b;return this};b.prototype.reset=function(){return this.set(0,0,0,1)};b.prototype.length=function(){var c=this.x,d=this.y,a=this.z,b=this.w;return Math.sqrt(c*c+d*d+a*a+b*b)};b.prototype.dot=function(c){return this.x*c.x+this.y*c.y+this.z*c.z+this.w*c.w};b.prototype.mult2=function(c,d){var a=c.x,b=c.y,p=c.z,k=c.w,h=d.x,i=d.y,j=d.z,m=d.w;this.x=m*a+h*k+i*p-j*b;this.y=
m*b+i*k+j*a-h*p;this.z=m*p+j*k+h*b-i*a;this.w=m*k-h*a-i*b-j*p;return this};b.prototype.mult=function(c){return this.mult2(this,c)};b.prototype.mult4=function(c,d,a,b){var p=this.x,k=this.y,h=this.z,i=this.w;this.x=b*p+c*i+d*h-a*k;this.y=b*k+d*i+a*p-c*h;this.z=b*h+a*i+c*k-d*p;this.w=b*i-c*p-d*k-a*h;return this};b.prototype.normalize=function(){var e=this.length();e>c&&(this.x/=e,this.y/=e,this.z/=e,this.w/=e);return this};b.prototype.rotate=function(e,d,a,b){var p=Math.sqrt(d*d+a*a+b*b);if(p>c){e/=
2;var k=Math.sin(e);this.mult4(d/p*k,a/p*k,b/p*k,Math.cos(e))}return this};b.prototype.toMat4=function(){var c=this.x+this.x,d=this.y+this.y,a=this.z+this.z,b=this.w*c,p=this.w*d,k=this.w*a;c*=this.x;var h=this.x*d,i=this.x*a;d*=this.y;var j=this.y*a;a*=this.z;return(new Embr.Mat4).set4x4r(1-(d+a),h-k,i+p,0,h+k,1-(c+a),j-b,0,i-p,j+b,1-(c+d),0,0,0,0,1)};b.prototype.dup=function(){return(new b).set(this.x,this.y,this.z,this.w)};return b}();
Embr.Noise=function(){for(var b=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],c=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,
73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,
222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],e=Array(512),d=0;d<512;d++)e[d]=c[d&255];var a=0.5*(Math.sqrt(3)-1),f=(3-Math.sqrt(3))/6,p=1/3,k=1/6;return{sn2:function(c,d){var j,m,g;g=(c+d)*a;var o=Math.floor(c+g),k=Math.floor(d+g);g=(o+k)*f;j=c-(o-g);var l=d-(k-g),r,n;j>l?(r=1,n=0):(r=0,n=1);m=j-r+f;var q=l-n+f;g=j-1+2*f;var p=l-1+2*f,t=o&255;k&=255;o=e[t+e[k]]%12;r=e[t+r+e[k+n]]%12;n=e[t+1+e[k+1]]%12;t=0.5-j*j-l*l;t<0?j=0:(t*=t,j=t*t*(b[o][0]*j+b[o][1]*l));l=0.5-m*m-q*q;l<0?m=0:(l*=
l,m=l*l*(b[r][0]*m+b[r][1]*q));q=0.5-g*g-p*p;q<0?g=0:(q*=q,g=q*q*(b[n][0]*g+b[n][1]*p));return 70*(j+m+g)},sn3:function(a,c,d){var f,g,o=(a+c+d)*p,s=Math.floor(a+o),l=Math.floor(c+o),r=Math.floor(d+o),o=(s+l+r)*k;f=a-(s-o);g=c-(l-o);var n=d-(r-o),q,v,t,w,u,A;f>=g?g>=n?(q=1,t=v=0,u=w=1,A=0):(f>=n?(q=1,t=v=0):(v=q=0,t=1),w=1,u=0,A=1):g<n?(v=q=0,t=1,w=0,A=u=1):f<n?(q=0,v=1,w=t=0,A=u=1):(q=0,v=1,t=0,u=w=1,A=0);var y=f-q+k,D=g-v+k,E=n-t+k,a=f-w+2*k,z=g-u+2*k,F=n-A+2*k,d=f-1+3*k,c=g-1+3*k,o=n-1+3*k;s&=
255;var B=l&255,C=r&255,l=e[s+e[B+e[C]]]%12,r=e[s+q+e[B+v+e[C+t]]]%12;w=e[s+w+e[B+u+e[C+A]]]%12;s=e[s+1+e[B+1+e[C+1]]]%12;u=0.6-f*f-g*g-n*n;u<0?f=0:(u*=u,f=u*u*(b[l][0]*f+b[l][1]*g+b[l][2]*n));g=0.6-y*y-D*D-E*E;g<0?g=0:(g*=g,g=g*g*(b[r][0]*y+b[r][1]*D+b[r][2]*E));y=0.6-a*a-z*z-F*F;y<0?a=0:(y*=y,a=y*y*(b[w][0]*a+b[w][1]*z+b[w][2]*F));z=0.6-d*d-c*c-o*o;z<0?d=0:(z*=z,d=z*z*(b[s][0]*d+b[s][1]*c+b[s][2]*o));return 32*(f+g+a+d)}}}();
Embr.Texture=function(){function b(c,e,d,a,b){this.width=e;this.height=heigth;b===void 0&&(b={});var a=b.filter_min!==void 0?b.filter_min:c.NEAREST,p=b.filter_mag!==void 0?b.filter_mag:c.NEAREST,k=b.wrap_s!==void 0?b.wrap_s:c.CLAMP_TO_EDGE,h=b.wrap_t!==void 0?b.wrap_t:c.CLAMP_TO_EDGE;this.target=b.target!==void 0?b.target:c.TEXTURE_2D;this.format=b.format!==void 0?b.format:c.RGBA;this.formati=b.formati!==void 0?b.formati:c.RGBA;this.type=b.type!==void 0?b.type:c.UNSIGNED_BYTE;this.handle=c.createTexture();
c.bindTexture(this.target,this.handle);c.texImage2D(target,0,this.formati,e,d,0,this.format,type,tex_data);c.texParameteri(this.target,c.TEXTURE_MIN_FILTER,a);c.texParameteri(this.target,c.TEXTURE_MAG_FILTER,p);c.texParameteri(this.target,c.TEXTURE_WRAP_S,k);c.texParameteri(this.target,c.TEXTURE_WRAP_T,h)}b.prototype.bind=function(c){var e=this.gl;c!==void 0&&e.activeTexture(e.TEXTURE0+c);e.bindTexture(this.target,obj)};b.prototype.unbind=function(c){var e=this.gl;c!==void 0&&e.activeTexture(e.TEXTURE0+
c);e.bindTexture(this.target,null)};b.prototype.update=function(c){var e=this.gl;e.bindTexture(this.target,this.handle);e.texSubImage2D(this.target,0,0,0,this.width,this.height,this.format,this.type,c)};return b}();
Embr.Fbo=function(){function b(c,e,d,a){this.gl=c;this.width=e;this.height=d;this.tex_attachments=[];this.render_attachments=[];this.handle=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,this.handle);for(var b=0,p=a.length,k=0;b<p;b++){var h=a[b],i=h.target!==void 0?h.target:c.TEXTURE_2D,j=h.formati!==void 0?h.formati:c.RGBA,m=h.attach!==void 0?h.attach:c.COLOR_ATTACHMENT0+k++;if(i==c.RENDERBUFFER){var g=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,g);c.renderbufferStorage(i,j,
e,d);c.framebufferRenderbuffer(c.FRAMEBUFFER,m,i,g);this.render_attachments.push({handle:g})}else{var g=h.format!==void 0?h.format:c.RGBA,o=h.type!==void 0?h.type:c.UNSIGNED_BYTE,s=h.filter_min!==void 0?h.filter_min:c.NEAREST,l=h.filter_mag!==void 0?h.filter_mag:c.NEAREST,r=h.wrap_s!==void 0?h.wrap_s:c.CLAMP_TO_EDGE,h=h.wrap_t!==void 0?h.wrap_t:c.CLAMP_TO_EDGE,n=c.createTexture();c.bindTexture(i,n);c.texImage2D(i,0,j,e,d,0,g,o,null);c.texParameteri(i,c.TEXTURE_MIN_FILTER,s);c.texParameteri(i,c.TEXTURE_MAG_FILTER,
l);c.texParameteri(i,c.TEXTURE_WRAP_S,r);c.texParameteri(i,c.TEXTURE_WRAP_T,h);c.framebufferTexture2D(c.FRAMEBUFFER,m,i,n,0);this.tex_attachments.push({handle:n,target:i,unit:c.TEXTURE0})}}if(c.checkFramebufferStatus(c.FRAMEBUFFER)!==c.FRAMEBUFFER_COMPLETE)throw"Incomplete frame buffer object.";c.bindFramebuffer(c.FRAMEBUFFER,null)}b.prototype.bind=function(){var c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,this.handle)};b.prototype.unbind=function(){var c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,null)};
b.prototype.bindTexture=function(c,b){var d=this.gl,a=this.tex_attachments[c];if(b!==void 0)a.unit=d.TEXTURE0+b;d.activeTexture(a.unit);d.bindTexture(a.target,a.handle)};b.prototype.unbindTexture=function(c){var b=this.gl,c=this.tex_attachments[c];b.activeTexture(c.unit);b.bindTexture(c.target,null)};return b}();
Embr.PingPong=function(){function b(c,b,d,a){this.wbuffer=new Embr.Fbo(c,b,d,a);this.rbuffer=new Embr.Fbo(c,b,d,a);this.swap()}b.prototype.swap=function(){var c=this.wbuffer;this.wbuffer=this.rbuffer;this.rbuffer=c};b.prototype.bind=function(){this.wbuffer.bind()};b.prototype.unbind=function(){this.wbuffer.unbind()};b.prototype.bindTexture=function(){this.rbuffer.bindTexture.apply(this.rbuffer,arguments)};b.prototype.unbindTexture=function(){this.rbuffer.unbindTexture.apply(this.rbuffer,arguments)};
return b}();
Embr.Vbo=function(){function b(c,b,d,a){function f(b,e,f){var g=c.createBuffer();c.bindBuffer(e,g);c.bufferData(e,f,d);Embr.Util.glCheckErr(c,"Error adding attribute '"+b+"'");var h=a[b],s=h.size!==void 0?h.size:1,l=h.location;h.location===void 0&&e===c.ARRAY_BUFFER&&(l=k++);p.attributes[b]={buffer:g,target:e,size:s,length:Math.floor(f.length/s),location:l}}this.gl=c;this.type=b;this.usage=d;this.attributes={};var p=this,k=0,h;for(h in a)b=a[h],h==="index"?f(h,c.ELEMENT_ARRAY_BUFFER,new Uint16Array(b.data)):f(h,
c.ARRAY_BUFFER,new Float32Array(b.data));if(!this.attributes.index)for(h in this.length=Number.MAX_VALUE,this.attributes)this.length=Math.min(this.length,this.attributes[h].length)}b.prototype.draw=function(){var c=this.gl,b;for(b in this.attributes){var d=this.attributes[b];d.target==c.ARRAY_BUFFER&&(c.bindBuffer(d.target,d.buffer),c.vertexAttribPointer(d.location,d.size,c.FLOAT,!1,0,0),c.enableVertexAttribArray(d.location))}(b=this.attributes.index)?(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,b.buffer),
c.drawElements(this.type,b.length,c.UNSIGNED_SHORT,0)):c.drawArrays(this.type,0,this.length)};b.prototype.destroy=function(){for(var c=this.gl,b=attributes.length;--b>=0;)c.deleteBuffer(attributes[b])};b.makePlane=function(c,b,d,a,f){return new Embr.Vbo(c,c.TRIANGLE_STRIP,c.STATIC_DRAW,{position:{data:[b,d,0,b,f,0,a,d,0,a,f,0],size:3},texcoord:{data:[0,0,0,1,1,0,1,1],size:2}})};b.makeCube=function(c,b,d,a){return new Embr.Vbo(c,c.TRIANGLES,c.STATIC_DRAW,{position:{data:[b,d,a,b,-d,a,b,-d,-a,b,d,-a,
b,d,a,b,d,-a,-b,d,-a,-b,d,a,b,d,a,-b,d,a,-b,-d,a,b,-d,a,-b,d,a,-b,d,-a,-b,-d,-a,-b,-d,a,-b,-d,-a,b,-d,-a,b,-d,a,-b,-d,a,b,-d,-a,-b,-d,-a,-b,d,-a,b,d,-a],size:3},normal:{data:[1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],size:3},texcoord:{data:[0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1],size:2},index:{data:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,
10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}})};return b}();
Embr.Program=function(){function b(b,d,a){this.gl=b;var f=this.shader_vert=b.createShader(b.VERTEX_SHADER);b.shaderSource(f,c+d);b.compileShader(f);if(b.getShaderParameter(f,b.COMPILE_STATUS)!==!0)throw b.getShaderInfoLog(f);d=this.shader_frag=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(d,c+a);b.compileShader(d);if(b.getShaderParameter(d,b.COMPILE_STATUS)!==!0)throw b.getShaderInfoLog(d);this.handle=b.createProgram()}var c="#ifdef GL_ES\nprecision highp float;\n#endif\n";b.prototype.link=function(){function c(a,
e){switch(a){case b.BOOL:case b.INT:case b.SAMPLER_2D:case b.SAMPLER_CUBE:return function(a){b.uniform1i(e,a);return this};case b.FLOAT:return function(a){b.uniform1f(e,a);return this};case b.FLOAT_VEC2:return function(a){b.uniform2f(e,a.x,a.y)};case b.FLOAT_VEC3:return function(a){b.uniform3f(e,a.x,a.y,a.z)};case b.FLOAT_VEC4:return function(a){b.uniform4f(e,a.x,a.y,a.z,a.w)};case b.FLOAT_MAT4:return function(a){b.uniformMatrix4fv(e,!1,a.toFloat32Array())}}return function(){throw"Unknown uniform type: "+
a;}}var b=this.gl,a=this.handle;b.attachShader(a,this.shader_vert);b.attachShader(a,this.shader_frag);b.linkProgram(a);if(b.getProgramParameter(a,b.LINK_STATUS)!==!0)throw b.getProgramInfoLog(a);this.locations={};for(var f=b.getProgramParameter(a,b.ACTIVE_UNIFORMS),p=0;p<f;++p){var k=b.getActiveUniform(a,p),h=b.getUniformLocation(a,k.name);this["set"+(k.name.charAt(0).toUpperCase()+k.name.slice(1))]=c(k.type,h);this.locations[k.name]=h}f=b.getProgramParameter(a,b.ACTIVE_ATTRIBUTES);for(p=0;p<f;++p)k=
b.getActiveAttrib(a,p),h=b.getAttribLocation(a,k.name),this.locations[k.name]=h};b.prototype.use=function(){this.gl.useProgram(this.handle)};b.prototype.dispose=function(){this.gl.deleteShader(this.shader_vert);this.gl.deleteShader(this.shader_frag);this.gl.deleteProgram(this.handle)};return b}();
Embr.Material=function(){function b(b,e,d){Embr.Program.call(this,b,e,d);this.link()}b.prototype=Object.create(Embr.Program.prototype);b.prototype.assignLocations=function(b){for(var e in this.attribute_locations)if(e in b.attributes)b.attributes[e].location=this.attribute_locations[e]};return b}();
Embr.ColorMaterial=function(){function b(b){Embr.Material.call(this,b,c,e);this.attribute_locations={position:this.program.locations.a_position,color:this.program.locations.a_color}}var c="uniform mat4 modelview, projection;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvoid main(){\nv_color = a_color;\ngl_Position = projection * modelview * vec4(a_position, 1.0);\n}",e="uniform vec4 color;\nvarying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color * color;\n}";b.prototype=
Object.create(Embr.Material);return b}();
Embr.NormalMaterial=function(){function b(b){Embr.Material.call(this,b,c,e);this.attribute_locations={position:this.locations.a_position,normal:this.locations.a_normal}}var c="uniform mat4 modelview, projection;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nvarying vec4 v_color;\nvoid main(){\nvec4 normal = modelview * vec4(a_normal, 0.0);\nv_color = vec4((normal.xyz + 1.0) * 0.5, 1.0);\ngl_Position = projection * modelview * vec4(a_position, 1.0);\n}",e="varying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}";
b.prototype=Object.create(Embr.Material.prototype);return b}();
