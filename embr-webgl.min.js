var Embr=Embr!==void 0?Embr:{};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){window.setTimeout(c,1E3/60)}}();
Embr.run=function(c,b){var e=null;try{e=c.getContext("experimental-webgl")}catch(f){console.error(f)}if(e){console.log(["EMBR made a GL context!",e.getParameter(e.VERSION),e.getParameter(e.VENDOR),e.getParameter(e.RENDERER),e.getParameter(e.SHADING_LANGUAGE_VERSION)].join(" | "));b.gl=e;b.width=c.width=c.offsetWidth;b.height=c.height=c.offsetHeight;e.viewport(0,0,b.width,b.height);var a=null;b.framerate=function(d){a!==null&&clearInterval(a);d!==0&&(a=setInterval(function(){b._step()},1E3/d))};if(b.init)try{b.init()}catch(d){console.error("Exception caught in init: "+
d)}var p=0,g=Date.now(),k=!0;b._step=function(){if(b.step){b.frameid=p;b.frametime=(Date.now()-g)/1E3;try{b.step()}catch(a){console.error("Exception caught in step: "+a)}k=!0;p++}};b._draw=function(){if(b.draw&&k){try{b.draw()}catch(a){console.error("Exception caught in draw: "+a)}k=!1}window.requestAnimationFrame(b._draw,c)};b._step();b._draw();return b}};
(function(){function c(a,d,b){this.x=a;this.y=d;this.z=b}function b(a,d){this.x=a;this.y=d}function e(a,d,b,e){this.x=a;this.y=d;this.z=b;this.w=e}function f(){this.reset()}c.prototype.set=function(a,d,b){this.x=a;this.y=d;this.z=b;return this};c.prototype.setVec3=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};c.prototype.cross2=function(a,d){var b=a.x,e=a.y,f=a.z,c=d.x,i=d.y,j=d.z;this.x=e*j-f*i;this.y=f*c-b*j;this.z=b*i-e*c;return this};c.prototype.cross=function(a){return this.cross2(this,
a)};c.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};c.prototype.add2=function(a,d){this.x=a.x+d.x;this.y=a.y+d.y;this.z=a.z+d.z;return this};c.prototype.added2=function(a,d){return new c(a.x+d.x,a.y+d.y,a.z+d.z)};c.prototype.add=function(a){return this.add2(this,a)};c.prototype.added=function(a){return this.added2(this,a)};c.prototype.sub2=function(a,d){this.x=a.x-d.x;this.y=a.y-d.y;this.z=a.z-d.z;return this};c.prototype.subbed2=function(a,d){return new c(a.x-d.x,a.y-d.y,a.z-
d.z)};c.prototype.sub=function(a){return this.sub2(this,a)};c.prototype.subbed=function(a){return this.subbed2(this,a)};c.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};c.prototype.scaled=function(a){return new c(this.x*a,this.y*a,this.z*a)};c.prototype.lerp=function(a,d){this.x+=(a.x-this.x)*d;this.y+=(a.y-this.y)*d;this.z+=(a.z-this.z)*d;return this};c.prototype.lerped=function(a,d){return new c(this.x+(a.x-this.x)*d,this.y+(a.y-this.y)*d,this.z+(a.z-this.z)*d)};c.prototype.length=
function(){var a=this.x,d=this.y,b=this.z;return Math.sqrt(a*a+d*d+b*b)};c.prototype.lengthSquared=function(){var a=this.x,d=this.y,b=this.z;return a*a+d*d+b*b};c.prototype.normalize=function(){return this.scale(1/this.length())};c.prototype.normalized=function(){return this.dup().normalize()};c.prototype.dup=function(){return new c(this.x,this.y,this.z)};c.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z};b.prototype.set=function(a,d){this.x=a;this.y=d;return this};
b.prototype.setVec2=function(a){this.x=a.x;this.y=a.y;return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.add2=function(a,d){this.x=a.x+d.x;this.y=a.y+d.y;return this};b.prototype.added2=function(a,d){return new b(a.x+d.x,a.y+d.y)};b.prototype.add=function(a){return this.add2(this,a)};b.prototype.added=function(a){return this.added2(this,a)};b.prototype.sub2=function(a,d){this.x=a.x-d.x;this.y=a.y-d.y;return this};b.prototype.subbed2=function(a,d){return new b(a.x-d.x,
a.y-d.y)};b.prototype.sub=function(a){return this.sub2(this,a)};b.prototype.subbed=function(a){return this.subbed2(this,a)};b.prototype.scale=function(a){this.x*=a;this.y*=a;return this};b.prototype.scaled=function(a){return new b(this.x*a,this.y*a)};b.prototype.lerp=function(a,d){this.x+=(a.x-this.x)*d;this.y+=(a.y-this.y)*d;return this};b.prototype.lerped=function(a,d){return new b(this.x+(a.x-this.x)*d,this.y+(a.y-this.y)*d)};b.prototype.length=function(){var a=this.x,d=this.y;return Math.sqrt(a*
a+d*d)};b.prototype.lengthSquared=function(){var a=this.x,d=this.y;return a*a+d*d};b.prototype.normalize=function(){return this.scale(1/this.length())};b.prototype.normalized=function(){return this.dup().normalize()};b.prototype.dup=function(){return new b(this.x,this.y)};b.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y};e.prototype.set=function(a,d,b,e){this.x=a;this.y=d;this.z=b;this.w=e;return this};e.prototype.setVec4=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;
return this};e.prototype.dup=function(){return new e(this.x,this.y,this.z,this.w)};e.prototype.toVec3=function(){return new c(this.x,this.y,this.z)};f.prototype.set4x4r=function(a,d,b,e,f,c,i,j,h,l,m,n,r,o,q,t){this.a11=a;this.a12=d;this.a13=b;this.a14=e;this.a21=f;this.a22=c;this.a23=i;this.a24=j;this.a31=h;this.a32=l;this.a33=m;this.a34=n;this.a41=r;this.a42=o;this.a43=q;this.a44=t;return this};f.prototype.reset=function(){this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};f.prototype.mul2=
function(a,d){var b=a.a11,e=a.a12,f=a.a13,c=a.a14,i=a.a21,j=a.a22,h=a.a23,l=a.a24,m=a.a31,n=a.a32,r=a.a33,o=a.a34,q=a.a41,t=a.a42,s=a.a43,w=a.a44,u=d.a11,A=d.a12,y=d.a13,D=d.a14,E=d.a21,z=d.a22,F=d.a23,B=d.a24,C=d.a31,G=d.a32,x=d.a33,H=d.a34,I=d.a41,J=d.a42,K=d.a43,L=d.a44;this.a11=b*u+e*E+f*C+c*I;this.a12=b*A+e*z+f*G+c*J;this.a13=b*y+e*F+f*x+c*K;this.a14=b*D+e*B+f*H+c*L;this.a21=i*u+j*E+h*C+l*I;this.a22=i*A+j*z+h*G+l*J;this.a23=i*y+j*F+h*x+l*K;this.a24=i*D+j*B+h*H+l*L;this.a31=m*u+n*E+r*C+o*I;this.a32=
m*A+n*z+r*G+o*J;this.a33=m*y+n*F+r*x+o*K;this.a34=m*D+n*B+r*H+o*L;this.a41=q*u+t*E+s*C+w*I;this.a42=q*A+t*z+s*G+w*J;this.a43=q*y+t*F+s*x+w*K;this.a44=q*D+t*B+s*H+w*L;return this};f.prototype.mul=function(a){return this.mul2(this,a)};f.prototype.mul4x4r=function(a,d,b,e,f,c,i,j,h,l,m,n,r,o,q,t){var s=this.a11,w=this.a12,u=this.a13,A=this.a14,y=this.a21,D=this.a22,E=this.a23,z=this.a24,F=this.a31,B=this.a32,C=this.a33,G=this.a34,x=this.a41,H=this.a42,I=this.a43,J=this.a44;this.a11=s*a+w*f+u*h+A*r;this.a12=
s*d+w*c+u*l+A*o;this.a13=s*b+w*i+u*m+A*q;this.a14=s*e+w*j+u*n+A*t;this.a21=y*a+D*f+E*h+z*r;this.a22=y*d+D*c+E*l+z*o;this.a23=y*b+D*i+E*m+z*q;this.a24=y*e+D*j+E*n+z*t;this.a31=F*a+B*f+C*h+G*r;this.a32=F*d+B*c+C*l+G*o;this.a33=F*b+B*i+C*m+G*q;this.a34=F*e+B*j+C*n+G*t;this.a41=x*a+H*f+I*h+J*r;this.a42=x*d+H*c+I*l+J*o;this.a43=x*b+H*i+I*m+J*q;this.a44=x*e+H*j+I*n+J*t;return this};f.prototype.rotate=function(a,d,b,e){var f=Math.sin(a),a=Math.cos(a);this.mul4x4r(d*d*(1-a)+a,d*b*(1-a)-e*f,d*e*(1-a)+b*f,
0,b*d*(1-a)+e*f,b*b*(1-a)+a,b*e*(1-a)-d*f,0,d*e*(1-a)-b*f,b*e*(1-a)+d*f,e*e*(1-a)+a,0,0,0,0,1);return this};f.prototype.translate=function(a,d,b){this.mul4x4r(1,0,0,a,0,1,0,d,0,0,1,b,0,0,0,1);return this};f.prototype.scale=function(a,d,b){this.mul4x4r(a,0,0,0,0,d,0,0,0,0,b,0,0,0,0,1);return this};f.prototype.lookAt=function(a,d,b,e,f,v,i,j,h){e=(new c(a-e,d-f,b-v)).normalize();i=(new c(i,j,h)).cross(e).normalize();j=e.dup().cross(i).normalize();this.mul4x4r(i.x,i.y,i.z,0,j.x,j.y,j.z,0,e.x,e.y,e.z,
0,0,0,0,1);this.translate(-a,-d,-b);return this};f.prototype.frustum=function(a,d,b,e,f,c){this.mul4x4r((f+f)/(d-a),0,(d+a)/(d-a),0,0,(f+f)/(e-b),(e+b)/(e-b),0,0,0,(c+f)/(f-c),2*c*f/(f-c),0,0,-1,0);return this};f.prototype.perspective=function(a,d,b,e){a=1/Math.tan(a*Math.PI/360);this.mul4x4r(a/d,0,0,0,0,a,0,0,0,0,(e+b)/(b-e),2*b*e/(b-e),0,0,-1,0);return this};f.prototype.ortho=function(a,d,b,e,f,c){this.mul4x4r(2/(d-a),0,0,(d+a)/(a-d),0,2/(e-b),0,(e+b)/(b-e),0,0,2/(f-c),(c+f)/(f-c),0,0,0,1);return this};
f.prototype.invert=function(){var a=this.a11,d=this.a12,b=this.a13,e=this.a14,f=this.a21,c=this.a22,i=this.a23,j=this.a24,h=this.a31,l=this.a32,m=this.a33,n=this.a34,r=this.a41,o=this.a42,q=this.a43,t=this.a44,s=a*c-d*f,w=a*i-b*f,u=a*j-e*f,A=d*i-b*c,y=d*j-e*c,D=b*j-e*i,E=h*o-l*r,z=h*q-m*r,F=h*t-n*r,B=l*q-m*o,C=l*t-n*o,G=m*t-n*q,x=1/(s*G-w*C+u*B+A*F-y*z+D*E);this.a11=(+c*G-i*C+j*B)*x;this.a12=(-d*G+b*C-e*B)*x;this.a13=(+o*D-q*y+t*A)*x;this.a14=(-l*D+m*y-n*A)*x;this.a21=(-f*G+i*F-j*z)*x;this.a22=(+a*
G-b*F+e*z)*x;this.a23=(-r*D+q*u-t*w)*x;this.a24=(+h*D-m*u+n*w)*x;this.a31=(+f*C-c*F+j*E)*x;this.a32=(-a*C+d*F-e*E)*x;this.a33=(+r*y-o*u+t*s)*x;this.a34=(-h*y+l*u-n*s)*x;this.a41=(-f*B+c*z-i*E)*x;this.a42=(+a*B-d*z+b*E)*x;this.a43=(-r*A+o*w-q*s)*x;this.a44=(+h*A-l*w+m*s)*x;return this};f.prototype.transpose=function(){var a=this.a12,b=this.a13,e=this.a14,f=this.a21,c=this.a22,v=this.a23,i=this.a24,j=this.a31,h=this.a32,l=this.a33,m=this.a34,n=this.a41,r=this.a42,o=this.a43,q=this.a44;this.a11=this.a11;
this.a12=f;this.a13=j;this.a14=n;this.a21=a;this.a22=c;this.a23=h;this.a24=r;this.a31=b;this.a32=v;this.a33=l;this.a34=o;this.a41=e;this.a42=i;this.a43=m;this.a44=q;return this};f.prototype.mulVec3=function(a){var b=a.x,e=a.y,a=a.z;return new c(this.a14+this.a11*b+this.a12*e+this.a13*a,this.a24+this.a21*b+this.a22*e+this.a23*a,this.a34+this.a31*b+this.a32*e+this.a33*a)};f.prototype.mulVec4=function(a){var b=a.x,f=a.y,c=a.z,a=a.w;return new e(this.a14*a+this.a11*b+this.a12*f+this.a13*c,this.a24*a+
this.a21*b+this.a22*f+this.a23*c,this.a34*a+this.a31*b+this.a32*f+this.a33*c,this.a44*a+this.a41*b+this.a42*f+this.a43*c)};f.prototype.dup=function(){var a=new f;a.set4x4r(this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44);return a};f.prototype.toFloat32Array=function(){return new Float32Array([this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,
this.a24,this.a34,this.a44])};f.prototype.debugString=function(){for(var a=[this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44],b=[0,0,0,0],e=0;e<16;++e){a[e]+="";var f=a[e].length,c=e&3;b[c]<f&&(b[c]=f)}c="";for(e=0;e<16;++e){f=a[e].length;for(f=b[e&3]-f;f--;)c+=" ";c+=a[e]+((e&3)===3?"\n":"  ")}return c};Embr.Vec2=b;Embr.Vec3=c;Embr.Vec4=e;Embr.Mat4=f})();
Embr.Util=function(){function c(b){var a={},d;for(d in b)a[d]=b[d]instanceof Object?c(b[d]):b[d];return a}function b(e,a){if(a===void 0)return c(e);var d,p={},g;for(g in e)d=g in a?a[g]:e[g],p[g]=d instanceof Object?b(e[g],a[g]):d;return p}var e=null;return{glCheckErr:function(b,a){var d=b.getError();if(d!==b.NO_ERROR){if(e===null){e={};for(var c in b)typeof b[c]=="number"&&(e[b[c]]=c)}throw a+" ("+e[d]+")";}},mergeOptions:b}}();Embr.rand=function(c){return Math.random()*c};
Embr.rand2=function(c,b){return c+Math.random()*(b-c)};Embr.randSym=function(c){return c*2*Math.random()-c};(function(){Embr.kPI=Math.PI;Embr.kPI2=Math.PI/2;Embr.kPI4=Math.PI/4;var c=Embr.k2PI=Math.PI*2;Embr.randVec3=function(b){var e=Math.random()*c,f=Math.random()*2-1,a=Math.sqrt(1-f*f);return new Embr.Vec3(a*Math.cos(e)*b,a*Math.sin(e)*b,f*b)}})();
Embr.Quat=function(){function c(){this.reset()}var b=Math.pow(2,-24);c.prototype.set=function(b,f,a,d){this.x=b;this.y=f;this.z=a;this.w=d;return this};c.prototype.reset=function(){return this.set(0,0,0,1)};c.prototype.length=function(){var b=this.x,f=this.y,a=this.z,d=this.w;return Math.sqrt(b*b+f*f+a*a+d*d)};c.prototype.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w};c.prototype.mult2=function(b,f){var a=b.x,d=b.y,c=b.z,g=b.w,k=f.x,v=f.y,i=f.z,j=f.w;this.x=j*a+k*g+v*c-i*d;this.y=
j*d+v*g+i*a-k*c;this.z=j*c+i*g+k*d-v*a;this.w=j*g-k*a-v*d-i*c;return this};c.prototype.mult=function(b){return this.mult2(this,b)};c.prototype.mult4=function(b,c,a,d){var p=this.x,g=this.y,k=this.z,v=this.w;this.x=d*p+b*v+c*k-a*g;this.y=d*g+c*v+a*p-b*k;this.z=d*k+a*v+b*g-c*p;this.w=d*v-b*p-c*g-a*k;return this};c.prototype.normalize=function(){var e=this.length();e>b&&(this.x/=e,this.y/=e,this.z/=e,this.w/=e);return this};c.prototype.rotate=function(e,c,a,d){var p=Math.sqrt(c*c+a*a+d*d);if(p>b){e/=
2;var g=Math.sin(e);this.mult4(c/p*g,a/p*g,d/p*g,Math.cos(e))}return this};c.prototype.toMat4=function(){var b=this.x+this.x,c=this.y+this.y,a=this.z+this.z,d=this.w*b,p=this.w*c,g=this.w*a;b*=this.x;var k=this.x*c,v=this.x*a;c*=this.y;var i=this.y*a;a*=this.z;return(new Embr.Mat4).set4x4r(1-(c+a),k-g,v+p,0,k+g,1-(b+a),i-d,0,v-p,i+d,1-(b+c),0,0,0,0,1)};c.prototype.dup=function(){return(new c).set(this.x,this.y,this.z,this.w)};return c}();
Embr.Noise=function(){for(var c=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,
73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,
222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],e=Array(512),f=0;f<512;f++)e[f]=b[f&255];var a=0.5*(Math.sqrt(3)-1),d=(3-Math.sqrt(3))/6,p=1/3,g=1/6;return{sn2:function(b,f){var p,g,h;h=(b+f)*a;var l=Math.floor(b+h),m=Math.floor(f+h);h=(l+m)*d;p=b-(l-h);var n=f-(m-h),r,o;p>n?(r=1,o=0):(r=0,o=1);g=p-r+d;var q=n-o+d;h=p-1+2*d;var t=n-1+2*d,s=l&255;m&=255;l=e[s+e[m]]%12;r=e[s+r+e[m+o]]%12;o=e[s+1+e[m+1]]%12;s=0.5-p*p-n*n;s<0?p=0:(s*=s,p=s*s*(c[l][0]*p+c[l][1]*n));n=0.5-g*g-q*q;n<0?g=0:(n*=
n,g=n*n*(c[r][0]*g+c[r][1]*q));q=0.5-h*h-t*t;q<0?h=0:(q*=q,h=q*q*(c[o][0]*h+c[o][1]*t));return 70*(p+g+h)},sn3:function(a,b,d){var f,h,l=(a+b+d)*p,m=Math.floor(a+l),n=Math.floor(b+l),r=Math.floor(d+l),l=(m+n+r)*g;f=a-(m-l);h=b-(n-l);var o=d-(r-l),q,t,s,w,u,A;f>=h?h>=o?(q=1,s=t=0,u=w=1,A=0):(f>=o?(q=1,s=t=0):(t=q=0,s=1),w=1,u=0,A=1):h<o?(t=q=0,s=1,w=0,A=u=1):f<o?(q=0,t=1,w=s=0,A=u=1):(q=0,t=1,s=0,u=w=1,A=0);var y=f-q+g,D=h-t+g,E=o-s+g,a=f-w+2*g,z=h-u+2*g,F=o-A+2*g,d=f-1+3*g,b=h-1+3*g,l=o-1+3*g;m&=
255;var B=n&255,C=r&255,n=e[m+e[B+e[C]]]%12,r=e[m+q+e[B+t+e[C+s]]]%12;w=e[m+w+e[B+u+e[C+A]]]%12;m=e[m+1+e[B+1+e[C+1]]]%12;u=0.6-f*f-h*h-o*o;u<0?f=0:(u*=u,f=u*u*(c[n][0]*f+c[n][1]*h+c[n][2]*o));h=0.6-y*y-D*D-E*E;h<0?h=0:(h*=h,h=h*h*(c[r][0]*y+c[r][1]*D+c[r][2]*E));y=0.6-a*a-z*z-F*F;y<0?a=0:(y*=y,a=y*y*(c[w][0]*a+c[w][1]*z+c[w][2]*F));z=0.6-d*d-b*b-l*l;z<0?d=0:(z*=z,d=z*z*(c[m][0]*d+c[m][1]*b+c[m][2]*l));return 32*(f+h+a+d)}}}();
Embr.Texture=function(){function c(b,e,c,a,d){this.width=e;this.height=heigth;d===void 0&&(d={});var a=d.filter_min!==void 0?d.filter_min:b.NEAREST,p=d.filter_mag!==void 0?d.filter_mag:b.NEAREST,g=d.wrap_s!==void 0?d.wrap_s:b.CLAMP_TO_EDGE,k=d.wrap_t!==void 0?d.wrap_t:b.CLAMP_TO_EDGE;this.target=d.target!==void 0?d.target:b.TEXTURE_2D;this.format=d.format!==void 0?d.format:b.RGBA;this.formati=d.formati!==void 0?d.formati:b.RGBA;this.type=d.type!==void 0?d.type:b.UNSIGNED_BYTE;this.handle=b.createTexture();
b.bindTexture(this.target,this.handle);b.texImage2D(target,0,this.formati,e,c,0,this.format,type,tex_data);b.texParameteri(this.target,b.TEXTURE_MIN_FILTER,a);b.texParameteri(this.target,b.TEXTURE_MAG_FILTER,p);b.texParameteri(this.target,b.TEXTURE_WRAP_S,g);b.texParameteri(this.target,b.TEXTURE_WRAP_T,k)}c.prototype.bind=function(b){var e=this.gl;b!==void 0&&e.activeTexture(e.TEXTURE0+b);e.bindTexture(this.target,obj)};c.prototype.unbind=function(b){var e=this.gl;b!==void 0&&e.activeTexture(e.TEXTURE0+
b);e.bindTexture(this.target,null)};c.prototype.update=function(b){var e=this.gl;e.bindTexture(this.target,this.handle);e.texSubImage2D(this.target,0,0,0,this.width,this.height,this.format,this.type,b)};return c}();
Embr.Fbo=function(){function c(b,e,c,a){this.gl=b;this.width=e;this.height=c;this.tex_attachments=[];this.render_attachments=[];this.handle=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,this.handle);for(var d=0,p=a.length,g=0;d<p;d++){var k=a[d],v=k.target!==void 0?k.target:b.TEXTURE_2D,i=k.formati!==void 0?k.formati:b.RGBA,j=k.attach!==void 0?k.attach:b.COLOR_ATTACHMENT0+g++;if(v==b.RENDERBUFFER){var h=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,h);b.renderbufferStorage(v,i,
e,c);b.framebufferRenderbuffer(b.FRAMEBUFFER,j,v,h);this.render_attachments.push({handle:h})}else{var h=k.format!==void 0?k.format:b.RGBA,l=k.type!==void 0?k.type:b.UNSIGNED_BYTE,m=k.filter_min!==void 0?k.filter_min:b.NEAREST,n=k.filter_mag!==void 0?k.filter_mag:b.NEAREST,r=k.wrap_s!==void 0?k.wrap_s:b.CLAMP_TO_EDGE,k=k.wrap_t!==void 0?k.wrap_t:b.CLAMP_TO_EDGE,o=b.createTexture();b.bindTexture(v,o);b.texImage2D(v,0,i,e,c,0,h,l,null);b.texParameteri(v,b.TEXTURE_MIN_FILTER,m);b.texParameteri(v,b.TEXTURE_MAG_FILTER,
n);b.texParameteri(v,b.TEXTURE_WRAP_S,r);b.texParameteri(v,b.TEXTURE_WRAP_T,k);b.framebufferTexture2D(b.FRAMEBUFFER,j,v,o,0);this.tex_attachments.push({handle:o,target:v,unit:b.TEXTURE0})}}if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw"Incomplete frame buffer object.";b.bindFramebuffer(b.FRAMEBUFFER,null)}c.prototype.bind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.handle)};c.prototype.unbind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,null)};
c.prototype.bindTexture=function(b,e){var c=this.gl,a=this.tex_attachments[b];if(e!==void 0)a.unit=c.TEXTURE0+e;c.activeTexture(a.unit);c.bindTexture(a.target,a.handle)};c.prototype.unbindTexture=function(b){var e=this.gl,b=this.tex_attachments[b];e.activeTexture(b.unit);e.bindTexture(b.target,null)};return c}();
Embr.PingPong=function(){function c(b,e,c,a){this.wbuffer=new Embr.Fbo(b,e,c,a);this.rbuffer=new Embr.Fbo(b,e,c,a);this.swap()}c.prototype.swap=function(){var b=this.wbuffer;this.wbuffer=this.rbuffer;this.rbuffer=b};c.prototype.bind=function(){this.wbuffer.bind()};c.prototype.unbind=function(){this.wbuffer.unbind()};c.prototype.bindTexture=function(){this.rbuffer.bindTexture.apply(this.rbuffer,arguments)};c.prototype.unbindTexture=function(){this.rbuffer.unbindTexture.apply(this.rbuffer,arguments)};
return c}();
Embr.Vbo=function(){function c(b,e,c,a){function d(d,e,g){var j=b.createBuffer();b.bindBuffer(e,j);b.bufferData(e,g,c);Embr.Util.glCheckErr(b,"Error adding attribute '"+d+"'");var h=a[d],l=h.size!==void 0?h.size:1,m=h.location;h.location===void 0&&e===b.ARRAY_BUFFER&&(m=-1);p.attributes[d]={buffer:j,target:e,size:l,length:Math.floor(g.length/l),location:m}}this.gl=b;this.type=e;this.usage=c;this.attributes={};var p=this,g;for(g in a)g==="index"?d(g,b.ELEMENT_ARRAY_BUFFER,new Uint16Array(a[g].data)):d(g,
b.ARRAY_BUFFER,new Float32Array(a[g].data));if(!this.attributes.index)for(g in this.length=Number.MAX_VALUE,this.attributes)this.length=Math.min(this.length,this.attributes[g].length)}c.prototype.draw=function(){var b=this.gl,e;for(e in this.attributes){var c=this.attributes[e];c.target==b.ARRAY_BUFFER&&c.location>=0&&(b.bindBuffer(c.target,c.buffer),b.vertexAttribPointer(c.location,c.size,b.FLOAT,!1,0,0),b.enableVertexAttribArray(c.location))}(e=this.attributes.index)?(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
e.buffer),b.drawElements(this.type,e.length,b.UNSIGNED_SHORT,0)):b.drawArrays(this.type,0,this.length)};c.prototype.destroy=function(){for(var b=this.gl,e=attributes.length;--e>=0;)b.deleteBuffer(attributes[e])};c.makePlane=function(b,e,c,a,d){return new Embr.Vbo(b,b.TRIANGLE_STRIP,b.STATIC_DRAW,{position:{data:[e,c,0,e,d,0,a,c,0,a,d,0],size:3},texcoord:{data:[0,0,0,1,1,0,1,1],size:2}})};c.makeCube=function(b,e,c,a){return new Embr.Vbo(b,b.TRIANGLES,b.STATIC_DRAW,{position:{data:[e,c,a,e,-c,a,e,-c,
-a,e,c,-a,e,c,a,e,c,-a,-e,c,-a,-e,c,a,e,c,a,-e,c,a,-e,-c,a,e,-c,a,-e,c,a,-e,c,-a,-e,-c,-a,-e,-c,a,-e,-c,-a,e,-c,-a,e,-c,a,-e,-c,a,e,-c,-a,-e,-c,-a,-e,c,-a,e,c,-a],size:3},normal:{data:[1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],size:3},texcoord:{data:[0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1],size:2},index:{data:[0,1,2,0,2,3,4,5,6,
4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}})};return c}();
Embr.Program=function(){function c(b){for(var c,e=/^ *#include +"([\w\-\.]+)"/gm;c=e.exec(b);){var f=c[1];if(f in a)f=a[f],b=b.replace(RegExp(c[0]),f),e.lastIndex=c.index+f.length}return b}function b(a,b,g){this.gl=a;var b=c(b),g=g?c(g):b,k=this.shader_vert=a.createShader(a.VERTEX_SHADER);a.shaderSource(k,e+b);a.compileShader(k);if(a.getShaderParameter(k,a.COMPILE_STATUS)!==!0)throw a.getShaderInfoLog(k);b=this.shader_frag=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(b,f+g);a.compileShader(b);
if(a.getShaderParameter(b,a.COMPILE_STATUS)!==!0)throw a.getShaderInfoLog(b);this.handle=a.createProgram()}var e="#ifdef GL_ES\nprecision highp float;\n#endif\n#define EM_VERTEX\n",f="#ifdef GL_ES\nprecision highp float;\n#endif\n#define EM_FRAGMENT\n",a={};b.prototype.link=function(){function a(c,d){switch(c){case b.BOOL:case b.INT:case b.SAMPLER_2D:case b.SAMPLER_CUBE:return function(a){b.uniform1i(d,a);return this};case b.FLOAT:return function(a){b.uniform1f(d,a);return this};case b.FLOAT_VEC2:return function(a){b.uniform2f(d,
a.x,a.y)};case b.FLOAT_VEC3:return function(a){b.uniform3f(d,a.x,a.y,a.z)};case b.FLOAT_VEC4:return function(a){b.uniform4f(d,a.x,a.y,a.z,a.w)};case b.FLOAT_MAT4:return function(a){b.uniformMatrix4fv(d,!1,a.toFloat32Array())}}return function(){throw"Unknown uniform type: "+c;}}var b=this.gl,c=this.handle;b.attachShader(c,this.shader_vert);b.attachShader(c,this.shader_frag);b.linkProgram(c);if(b.getProgramParameter(c,b.LINK_STATUS)!==!0)throw b.getProgramInfoLog(c);this.uniforms={};this.locations=
{};for(var e=b.getProgramParameter(c,b.ACTIVE_UNIFORMS),f=0;f<e;++f){var i=b.getActiveUniform(c,f),j=b.getUniformLocation(c,i.name);this.uniforms[i.name]=a(i.type,j);this.locations[i.name]=j}e=b.getProgramParameter(c,b.ACTIVE_ATTRIBUTES);for(f=0;f<e;++f)i=b.getActiveAttrib(c,f),j=b.getAttribLocation(c,i.name),this.locations[i.name]=j};b.prototype.use=function(){this.gl.useProgram(this.handle)};b.prototype.useUniforms=function(a){this.use();var b=this.uniforms,c;for(c in a)b[c](a[c])};b.prototype.dispose=
function(){this.gl.deleteShader(this.shader_vert);this.gl.deleteShader(this.shader_frag);this.gl.deleteProgram(this.handle)};b.include=function(b,c){a[b]=c};return b}();
Embr.Material=function(){function c(b,c,f,a){f||(f=c);if(a&&a.flags){var d="",p;for(p in a.flags)a.flags[p]&&(d+="#define "+p+"\n");c=d+c;f=d+f}Embr.Program.call(this,b,c,f);this.link();this.attribute_locations={};if(a&&a.attributes)for(var g in a.attributes)b=a.attributes[g],b in this.locations&&(this.attribute_locations[g]=this.locations[b])}c.prototype=Object.create(Embr.Program.prototype);c.prototype.assignLocations=function(b){for(var c in b.attributes)b.attributes[c].location=c in this.attribute_locations?
this.attribute_locations[c]:-1};return c}();
Embr.ColorMaterial=function(){function c(a,c){c=Embr.Util.mergeOptions(f,c);Embr.Material.call(this,a,b,e,c)}var b="uniform mat4 modelview, projection;\nattribute vec3 a_position;\n#ifdef use_vertex_color\nattribute vec4 a_color;\nvarying vec4 v_color;\n#endif\n#ifdef use_texture\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\n#endif\nvoid main(){\n#ifdef use_vertex_color\nv_color = a_color;\n#endif\n#ifdef use_texture\nv_texcoord = a_texcoord;\n#endif\ngl_Position = projection * modelview * vec4(a_position, 1.0);\n}",e=
"uniform vec4 color;\n#ifdef use_vertex_color\nvarying vec4 v_color;\n#endif\n#ifdef use_texture\nuniform sampler2D texture;\nvarying vec2 v_texcoord;\n#endif\nvoid main(){\nvec4 c = color;\n#ifdef use_vertex_color\nc *= v_color;\n#endif\n#ifdef use_texture\nc *= texture2D(texture, v_texcoord);\n#endif\ngl_FragColor = c;\n}",f={attributes:{position:"a_position",texcoord:"a_texcoord",color:"a_color"},flags:{use_vertex_color:!1,use_texture:!1}};c.prototype=Object.create(Embr.Material.prototype);return c}();
Embr.NormalMaterial=function(){function c(a,c){c=Embr.Util.mergeOptions(f,c);Embr.Material.call(this,a,b,e,c)}var b="uniform mat4 modelview, projection;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nvarying vec4 v_color;\nvoid main(){\nvec4 normal = modelview * vec4(a_normal, 0.0);\nv_color = vec4((normal.xyz + 1.0) * 0.5, 1.0);\ngl_Position = projection * modelview * vec4(a_position, 1.0);\n}",e="varying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}",f={attributes:{position:"a_position",
normal:"a_normal"}};c.prototype=Object.create(Embr.Material.prototype);return c}();
