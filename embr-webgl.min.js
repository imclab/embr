var Embr=Embr!==void 0?Embr:{};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){window.setTimeout(c,1E3/60)}}();
Embr.run=function(c,b){var d=null;try{d=c.getContext("experimental-webgl")}catch(f){console.error(f)}if(d){console.log(["EMBR made a GL context!",d.getParameter(d.VERSION),d.getParameter(d.VENDOR),d.getParameter(d.RENDERER),d.getParameter(d.SHADING_LANGUAGE_VERSION)].join(" | "));b.gl=d;b.width=c.width=c.clientWidth;b.height=c.height=c.clientHeight;d.viewport(0,0,b.width,b.height);var a=null;b.framerate=function(e){a!==null&&clearInterval(a);e!==0&&(a=setInterval(function(){b._step()},1E3/e))};if(b.init)try{b.init()}catch(e){console.error("Exception caught in init: "+
e)}var F=0,m=Date.now(),g=!0;b._step=function(){if(b.step){b.frameid=F;b.frametime=(Date.now()-m)/1E3;try{b.step()}catch(a){console.error("Exception caught in step: "+a)}g=!0;F++}};b._draw=function(){if(b.draw&&g){try{b.draw()}catch(a){console.error("Exception caught in draw: "+a)}g=!1}window.requestAnimationFrame(b._draw,c)};b._step();b._draw();return b}};
(function(){function c(a,e,b){this.x=a;this.y=e;this.z=b}function b(a,e){this.x=a;this.y=e}function d(a,e,b,d){this.x=a;this.y=e;this.z=b;this.w=d}function f(){this.reset()}c.prototype.set=function(a,e,b){this.x=a;this.y=e;this.z=b;return this};c.prototype.setVec3=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};c.prototype.cross2=function(a,e){var b=a.x,d=a.y,g=a.z,c=e.x,f=e.y,j=e.z;this.x=d*j-g*f;this.y=g*c-b*j;this.z=b*f-d*c;return this};c.prototype.cross=function(a){return this.cross2(this,
a)};c.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};c.prototype.add2=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;this.z=a.z+e.z;return this};c.prototype.added2=function(a,e){return new c(a.x+e.x,a.y+e.y,a.z+e.z)};c.prototype.add=function(a){return this.add2(this,a)};c.prototype.added=function(a){return this.added2(this,a)};c.prototype.sub2=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;this.z=a.z-e.z;return this};c.prototype.subbed2=function(a,e){return new c(a.x-e.x,a.y-e.y,a.z-
e.z)};c.prototype.sub=function(a){return this.sub2(this,a)};c.prototype.subbed=function(a){return this.subbed2(this,a)};c.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};c.prototype.scaled=function(a){return new c(this.x*a,this.y*a,this.z*a)};c.prototype.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;this.z+=(a.z-this.z)*e;return this};c.prototype.lerped=function(a,e){return new c(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e,this.z+(a.z-this.z)*e)};c.prototype.length=
function(){var a=this.x,e=this.y,b=this.z;return Math.sqrt(a*a+e*e+b*b)};c.prototype.lengthSquared=function(){var a=this.x,e=this.y,b=this.z;return a*a+e*e+b*b};c.prototype.normalize=function(){return this.scale(1/this.length())};c.prototype.normalized=function(){return this.dup().normalize()};c.prototype.dup=function(){return new c(this.x,this.y,this.z)};c.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z};b.prototype.set=function(a,e){this.x=a;this.y=e;return this};
b.prototype.setVec2=function(a){this.x=a.x;this.y=a.y;return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.add2=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;return this};b.prototype.added2=function(a,e){return new b(a.x+e.x,a.y+e.y)};b.prototype.add=function(a){return this.add2(this,a)};b.prototype.added=function(a){return this.added2(this,a)};b.prototype.sub2=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;return this};b.prototype.subbed2=function(a,e){return new b(a.x-e.x,
a.y-e.y)};b.prototype.sub=function(a){return this.sub2(this,a)};b.prototype.subbed=function(a){return this.subbed2(this,a)};b.prototype.scale=function(a){this.x*=a;this.y*=a;return this};b.prototype.scaled=function(a){return new b(this.x*a,this.y*a)};b.prototype.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;return this};b.prototype.lerped=function(a,e){return new b(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e)};b.prototype.length=function(){var a=this.x,e=this.y;return Math.sqrt(a*
a+e*e)};b.prototype.lengthSquared=function(){var a=this.x,e=this.y;return a*a+e*e};b.prototype.normalize=function(){return this.scale(1/this.length())};b.prototype.normalized=function(){return this.dup().normalize()};b.prototype.dup=function(){return new b(this.x,this.y)};b.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y};d.prototype.set=function(a,e,b,d){this.x=a;this.y=e;this.z=b;this.w=d;return this};d.prototype.setVec4=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;
return this};d.prototype.dup=function(){return new d(this.x,this.y,this.z,this.w)};d.prototype.toVec3=function(){return new c(this.x,this.y,this.z)};f.prototype.set4x4r=function(a,e,b,d,g,c,f,j,h,k,n,l,t,o,p,s){this.a11=a;this.a12=e;this.a13=b;this.a14=d;this.a21=g;this.a22=c;this.a23=f;this.a24=j;this.a31=h;this.a32=k;this.a33=n;this.a34=l;this.a41=t;this.a42=o;this.a43=p;this.a44=s;return this};f.prototype.reset=function(){this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};f.prototype.mul2=
function(a,e){var b=a.a11,d=a.a12,g=a.a13,c=a.a14,f=a.a21,j=a.a22,h=a.a23,k=a.a24,n=a.a31,l=a.a32,t=a.a33,o=a.a34,p=a.a41,s=a.a42,r=a.a43,v=a.a44,u=e.a11,z=e.a12,x=e.a13,C=e.a14,D=e.a21,y=e.a22,E=e.a23,A=e.a24,B=e.a31,G=e.a32,w=e.a33,H=e.a34,I=e.a41,J=e.a42,K=e.a43,L=e.a44;this.a11=b*u+d*D+g*B+c*I;this.a12=b*z+d*y+g*G+c*J;this.a13=b*x+d*E+g*w+c*K;this.a14=b*C+d*A+g*H+c*L;this.a21=f*u+j*D+h*B+k*I;this.a22=f*z+j*y+h*G+k*J;this.a23=f*x+j*E+h*w+k*K;this.a24=f*C+j*A+h*H+k*L;this.a31=n*u+l*D+t*B+o*I;this.a32=
n*z+l*y+t*G+o*J;this.a33=n*x+l*E+t*w+o*K;this.a34=n*C+l*A+t*H+o*L;this.a41=p*u+s*D+r*B+v*I;this.a42=p*z+s*y+r*G+v*J;this.a43=p*x+s*E+r*w+v*K;this.a44=p*C+s*A+r*H+v*L;return this};f.prototype.mul=function(a){return this.mul2(this,a)};f.prototype.mul4x4r=function(a,e,b,d,g,c,f,j,h,k,n,l,t,o,p,s){var r=this.a11,v=this.a12,u=this.a13,z=this.a14,x=this.a21,C=this.a22,D=this.a23,y=this.a24,E=this.a31,A=this.a32,B=this.a33,G=this.a34,w=this.a41,H=this.a42,I=this.a43,J=this.a44;this.a11=r*a+v*g+u*h+z*t;this.a12=
r*e+v*c+u*k+z*o;this.a13=r*b+v*f+u*n+z*p;this.a14=r*d+v*j+u*l+z*s;this.a21=x*a+C*g+D*h+y*t;this.a22=x*e+C*c+D*k+y*o;this.a23=x*b+C*f+D*n+y*p;this.a24=x*d+C*j+D*l+y*s;this.a31=E*a+A*g+B*h+G*t;this.a32=E*e+A*c+B*k+G*o;this.a33=E*b+A*f+B*n+G*p;this.a34=E*d+A*j+B*l+G*s;this.a41=w*a+H*g+I*h+J*t;this.a42=w*e+H*c+I*k+J*o;this.a43=w*b+H*f+I*n+J*p;this.a44=w*d+H*j+I*l+J*s;return this};f.prototype.rotate=function(a,e,b,d){var g=Math.sin(a),a=Math.cos(a);this.mul4x4r(e*e*(1-a)+a,e*b*(1-a)-d*g,e*d*(1-a)+b*g,
0,b*e*(1-a)+d*g,b*b*(1-a)+a,b*d*(1-a)-e*g,0,e*d*(1-a)-b*g,b*d*(1-a)+e*g,d*d*(1-a)+a,0,0,0,0,1);return this};f.prototype.translate=function(a,e,b){this.mul4x4r(1,0,0,a,0,1,0,e,0,0,1,b,0,0,0,1);return this};f.prototype.scale=function(a,e,b){this.mul4x4r(a,0,0,0,0,e,0,0,0,0,b,0,0,0,0,1);return this};f.prototype.lookAt=function(a,e,b,d,g,f,i,j,h){d=(new c(a-d,e-g,b-f)).normalize();i=(new c(i,j,h)).cross(d).normalize();j=d.dup().cross(i).normalize();this.mul4x4r(i.x,i.y,i.z,0,j.x,j.y,j.z,0,d.x,d.y,d.z,
0,0,0,0,1);this.translate(-a,-e,-b);return this};f.prototype.frustum=function(a,e,b,d,g,f){this.mul4x4r((g+g)/(e-a),0,(e+a)/(e-a),0,0,(g+g)/(d-b),(d+b)/(d-b),0,0,0,(f+g)/(g-f),2*f*g/(g-f),0,0,-1,0);return this};f.prototype.perspective=function(a,e,b,d){a=1/Math.tan(a*Math.PI/360);this.mul4x4r(a/e,0,0,0,0,a,0,0,0,0,(d+b)/(b-d),2*b*d/(b-d),0,0,-1,0);return this};f.prototype.ortho=function(a,e,b,d,f,c){this.mul4x4r(2/(e-a),0,0,(e+a)/(a-e),0,2/(d-b),0,(d+b)/(b-d),0,0,2/(f-c),(c+f)/(f-c),0,0,0,1);return this};
f.prototype.invert=function(){var a=this.a11,e=this.a12,b=this.a13,d=this.a14,f=this.a21,c=this.a22,i=this.a23,j=this.a24,h=this.a31,k=this.a32,n=this.a33,l=this.a34,t=this.a41,o=this.a42,p=this.a43,s=this.a44,r=a*c-e*f,v=a*i-b*f,u=a*j-d*f,z=e*i-b*c,x=e*j-d*c,C=b*j-d*i,D=h*o-k*t,y=h*p-n*t,E=h*s-l*t,A=k*p-n*o,B=k*s-l*o,G=n*s-l*p,w=1/(r*G-v*B+u*A+z*E-x*y+C*D);this.a11=(+c*G-i*B+j*A)*w;this.a12=(-e*G+b*B-d*A)*w;this.a13=(+o*C-p*x+s*z)*w;this.a14=(-k*C+n*x-l*z)*w;this.a21=(-f*G+i*E-j*y)*w;this.a22=(+a*
G-b*E+d*y)*w;this.a23=(-t*C+p*u-s*v)*w;this.a24=(+h*C-n*u+l*v)*w;this.a31=(+f*B-c*E+j*D)*w;this.a32=(-a*B+e*E-d*D)*w;this.a33=(+t*x-o*u+s*r)*w;this.a34=(-h*x+k*u-l*r)*w;this.a41=(-f*A+c*y-i*D)*w;this.a42=(+a*A-e*y+b*D)*w;this.a43=(-t*z+o*v-p*r)*w;this.a44=(+h*z-k*v+n*r)*w;return this};f.prototype.transpose=function(){var a=this.a12,e=this.a13,b=this.a14,d=this.a21,f=this.a22,c=this.a23,i=this.a24,j=this.a31,h=this.a32,k=this.a33,n=this.a34,l=this.a41,t=this.a42,o=this.a43,p=this.a44;this.a11=this.a11;
this.a12=d;this.a13=j;this.a14=l;this.a21=a;this.a22=f;this.a23=h;this.a24=t;this.a31=e;this.a32=c;this.a33=k;this.a34=o;this.a41=b;this.a42=i;this.a43=n;this.a44=p;return this};f.prototype.mulVec3=function(a){var e=a.x,b=a.y,a=a.z;return new c(this.a14+this.a11*e+this.a12*b+this.a13*a,this.a24+this.a21*e+this.a22*b+this.a23*a,this.a34+this.a31*e+this.a32*b+this.a33*a)};f.prototype.mulVec4=function(a){var b=a.x,f=a.y,c=a.z,a=a.w;return new d(this.a14*a+this.a11*b+this.a12*f+this.a13*c,this.a24*a+
this.a21*b+this.a22*f+this.a23*c,this.a34*a+this.a31*b+this.a32*f+this.a33*c,this.a44*a+this.a41*b+this.a42*f+this.a43*c)};f.prototype.dup=function(){var a=new f;a.set4x4r(this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44);return a};f.prototype.toFloat32Array=function(){return new Float32Array([this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,
this.a24,this.a34,this.a44])};f.prototype.debugString=function(){for(var a=[this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44],b=[0,0,0,0],d=0;d<16;++d){a[d]+="";var f=a[d].length,c=d&3;b[c]<f&&(b[c]=f)}c="";for(d=0;d<16;++d){f=a[d].length;for(f=b[d&3]-f;f--;)c+=" ";c+=a[d]+((d&3)===3?"\n":"  ")}return c};Embr.Vec2=b;Embr.Vec3=c;Embr.Vec4=d;Embr.Mat4=f})();
Embr.Util=function(){var c=null;return{glCheckErr:function(b,d){var f=b.getError();if(f!==b.NO_ERROR){if(c===null){c={};for(var a in b)typeof b[a]=="number"&&(c[b[a]]=a)}throw d+" ("+c[f]+")";}}}}();Embr.rand=function(c,b){return c+Math.random()*(b-c)};Embr.randSym=function(c){return c*2*Math.random()-c};
(function(){Embr.kPI=Math.PI;Embr.kPI2=Math.PI/2;Embr.kPI4=Math.PI/4;var c=Embr.k2PI=Math.PI*2;Embr.randVec3=function(b){var d=Math.random()*c,f=Math.random()*2-1,a=Math.sqrt(1-f*f);return new Embr.Vec3(a*Math.cos(d)*b,a*Math.sin(d)*b,f*b)}})();
Embr.Quat=function(){function c(){this.reset()}var b=Math.pow(2,-24);c.prototype.set=function(b,f,a,e){this.x=b;this.y=f;this.z=a;this.w=e;return this};c.prototype.reset=function(){return this.set(0,0,0,1)};c.prototype.length=function(){var b=this.x,f=this.y,a=this.z,e=this.w;return Math.sqrt(b*b+f*f+a*a+e*e)};c.prototype.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w};c.prototype.mult2=function(b,f){var a=b.x,e=b.y,c=b.z,m=b.w,g=f.x,q=f.y,i=f.z,j=f.w;this.x=j*a+g*m+q*c-i*e;this.y=
j*e+q*m+i*a-g*c;this.z=j*c+i*m+g*e-q*a;this.w=j*m-g*a-q*e-i*c;return this};c.prototype.mult=function(b){return this.mult2(this,b)};c.prototype.mult4=function(b,f,a,e){var c=this.x,m=this.y,g=this.z,q=this.w;this.x=e*c+b*q+f*g-a*m;this.y=e*m+f*q+a*c-b*g;this.z=e*g+a*q+b*m-f*c;this.w=e*q-b*c-f*m-a*g;return this};c.prototype.normalize=function(){var d=this.length();d>b&&(this.x/=d,this.y/=d,this.z/=d,this.w/=d);return this};c.prototype.rotate=function(d,c,a,e){var F=Math.sqrt(c*c+a*a+e*e);if(F>b){d/=
2;var m=Math.sin(d);this.mult4(c/F*m,a/F*m,e/F*m,Math.cos(d))}return this};c.prototype.toMat4=function(){var b=this.x+this.x,c=this.y+this.y,a=this.z+this.z,e=this.w*b,F=this.w*c,m=this.w*a;b*=this.x;var g=this.x*c,q=this.x*a;c*=this.y;var i=this.y*a;a*=this.z;return(new Embr.Mat4).set4x4r(1-(c+a),g-m,q+F,0,g+m,1-(b+a),i-e,0,q-F,i+e,1-(b+c),0,0,0,0,1)};c.prototype.dup=function(){return(new c).set(this.x,this.y,this.z,this.w)};return c}();
Embr.Noise=function(){for(var c=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,
73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,
222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],d=Array(512),f=0;f<512;f++)d[f]=b[f&255];var a=0.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,F=1/3,m=1/6;return{sn2:function(b,f){var i,j,h;h=(b+f)*a;var k=Math.floor(b+h),n=Math.floor(f+h);h=(k+n)*e;i=b-(k-h);var l=f-(n-h),m,o;i>l?(m=1,o=0):(m=0,o=1);j=i-m+e;var p=l-o+e;h=i-1+2*e;var s=l-1+2*e,r=k&255;n&=255;k=d[r+d[n]]%12;m=d[r+m+d[n+o]]%12;o=d[r+1+d[n+1]]%12;r=0.5-i*i-l*l;r<0?i=0:(r*=r,i=r*r*(c[k][0]*i+c[k][1]*l));l=0.5-j*j-p*p;l<0?j=0:(l*=
l,j=l*l*(c[m][0]*j+c[m][1]*p));p=0.5-h*h-s*s;p<0?h=0:(p*=p,h=p*p*(c[o][0]*h+c[o][1]*s));return 70*(i+j+h)},sn3:function(a,b,e){var f,h,k=(a+b+e)*F,n=Math.floor(a+k),l=Math.floor(b+k),t=Math.floor(e+k),k=(n+l+t)*m;f=a-(n-k);h=b-(l-k);var o=e-(t-k),p,s,r,v,u,z;f>=h?h>=o?(p=1,r=s=0,u=v=1,z=0):(f>=o?(p=1,r=s=0):(s=p=0,r=1),v=1,u=0,z=1):h<o?(s=p=0,r=1,v=0,z=u=1):f<o?(p=0,s=1,v=r=0,z=u=1):(p=0,s=1,r=0,u=v=1,z=0);var x=f-p+m,C=h-s+m,D=o-r+m,a=f-v+2*m,y=h-u+2*m,E=o-z+2*m,e=f-1+3*m,b=h-1+3*m,k=o-1+3*m;n&=
255;var A=l&255,B=t&255,l=d[n+d[A+d[B]]]%12,t=d[n+p+d[A+s+d[B+r]]]%12;v=d[n+v+d[A+u+d[B+z]]]%12;n=d[n+1+d[A+1+d[B+1]]]%12;u=0.6-f*f-h*h-o*o;u<0?f=0:(u*=u,f=u*u*(c[l][0]*f+c[l][1]*h+c[l][2]*o));h=0.6-x*x-C*C-D*D;h<0?h=0:(h*=h,h=h*h*(c[t][0]*x+c[t][1]*C+c[t][2]*D));x=0.6-a*a-y*y-E*E;x<0?a=0:(x*=x,a=x*x*(c[v][0]*a+c[v][1]*y+c[v][2]*E));y=0.6-e*e-b*b-k*k;y<0?e=0:(y*=y,e=y*y*(c[n][0]*e+c[n][1]*b+c[n][2]*k));return 32*(f+h+a+e)}}}();
Embr.Texture=function(){function c(b,d,c,a,e){this.width=d;this.height=heigth;e===void 0&&(e={});var a=e.filter_min!==void 0?e.filter_min:b.NEAREST,F=e.filter_mag!==void 0?e.filter_mag:b.NEAREST,m=e.wrap_s!==void 0?e.wrap_s:b.CLAMP_TO_EDGE,g=e.wrap_t!==void 0?e.wrap_t:b.CLAMP_TO_EDGE;this.target=e.target!==void 0?e.target:b.TEXTURE_2D;this.format=e.format!==void 0?e.format:b.RGBA;this.formati=e.formati!==void 0?e.formati:b.RGBA;this.type=e.type!==void 0?e.type:b.UNSIGNED_BYTE;this.handle=b.createTexture();
b.bindTexture(this.target,this.handle);b.texImage2D(target,0,this.formati,d,c,0,this.format,type,tex_data);b.texParameteri(this.target,b.TEXTURE_MIN_FILTER,a);b.texParameteri(this.target,b.TEXTURE_MAG_FILTER,F);b.texParameteri(this.target,b.TEXTURE_WRAP_S,m);b.texParameteri(this.target,b.TEXTURE_WRAP_T,g)}c.prototype.bind=function(b){var d=this.gl;b!==void 0&&d.activeTexture(d.TEXTURE0+b);d.bindTexture(this.target,obj)};c.prototype.unbind=function(b){var d=this.gl;b!==void 0&&d.activeTexture(d.TEXTURE0+
b);d.bindTexture(this.target,null)};c.prototype.update=function(b){var d=this.gl;d.bindTexture(this.target,this.handle);d.texSubImage2D(this.target,0,0,0,this.width,this.height,this.format,this.type,b)};return c}();
Embr.Fbo=function(){function c(b,d,c,a){this.gl=b;this.width=d;this.height=c;this.tex_attachments=[];this.render_attachments=[];this.handle=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,this.handle);for(var e=0,F=a.length,m=0;e<F;e++){var g=a[e],q=g.target!==void 0?g.target:b.TEXTURE_2D,i=g.formati!==void 0?g.formati:b.RGBA,j=g.attach!==void 0?g.attach:b.COLOR_ATTACHMENT0+m++;if(q==b.RENDERBUFFER){var h=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,h);b.renderbufferStorage(q,i,
d,c);b.framebufferRenderbuffer(b.FRAMEBUFFER,j,q,h);this.render_attachments.push({handle:h})}else{var h=g.format!==void 0?g.format:b.RGBA,k=g.type!==void 0?g.type:b.UNSIGNED_BYTE,n=g.filter_min!==void 0?g.filter_min:b.NEAREST,l=g.filter_mag!==void 0?g.filter_mag:b.NEAREST,t=g.wrap_s!==void 0?g.wrap_s:b.CLAMP_TO_EDGE,g=g.wrap_t!==void 0?g.wrap_t:b.CLAMP_TO_EDGE,o=b.createTexture();b.bindTexture(q,o);b.texImage2D(q,0,i,d,c,0,h,k,null);b.texParameteri(q,b.TEXTURE_MIN_FILTER,n);b.texParameteri(q,b.TEXTURE_MAG_FILTER,
l);b.texParameteri(q,b.TEXTURE_WRAP_S,t);b.texParameteri(q,b.TEXTURE_WRAP_T,g);b.framebufferTexture2D(b.FRAMEBUFFER,j,q,o,0);this.tex_attachments.push({handle:o,target:q,unit:b.TEXTURE0})}}if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw"Incomplete frame buffer object.";b.bindFramebuffer(b.FRAMEBUFFER,null)}c.prototype.bind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.handle)};c.prototype.unbind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,null)};
c.prototype.bindTexture=function(b,d){var c=this.gl,a=this.tex_attachments[b];if(d!==void 0)a.unit=c.TEXTURE0+d;c.activeTexture(a.unit);c.bindTexture(a.target,a.handle)};c.prototype.unbindTexture=function(b){var d=this.gl,b=this.tex_attachments[b];d.activeTexture(b.unit);d.bindTexture(b.target,null)};return c}();
Embr.PingPong=function(){function c(b,d,c,a){this.wbuffer=new Embr.Fbo(b,d,c,a);this.rbuffer=new Embr.Fbo(b,d,c,a);this.swap()}c.prototype.swap=function(){var b=this.wbuffer;this.wbuffer=this.rbuffer;this.rbuffer=b};c.prototype.bind=function(){this.wbuffer.bind()};c.prototype.unbind=function(){this.wbuffer.unbind()};c.prototype.bindTexture=function(){this.rbuffer.bindTexture.apply(this.rbuffer,arguments)};c.prototype.unbindTexture=function(){this.rbuffer.unbindTexture.apply(this.rbuffer,arguments)};
return c}();
Embr.Program=function(){function c(b){for(var d,c=/^ *#include +"([\w\-\.]+)"/gm;d=c.exec(b);){var f=d[1];if(f in a)f=a[f],b=b.replace(RegExp(d[0]),f),c.lastIndex=d.index+f.length}return b}function b(a,b){function m(b,d){switch(b){case a.BOOL:case a.INT:case a.SAMPLER_2D:case a.SAMPLER_CUBE:return function(b){a.uniform1i(d,b);return this};case a.FLOAT:return function(b){a.uniform1f(d,b);return this};case a.FLOAT_VEC2:return function(b){a.uniform2f(d,b.x,b.y)};case a.FLOAT_VEC3:return function(b){a.uniform3f(d,b.x,
b.y,b.z)};case a.FLOAT_VEC4:return function(b){a.uniform4f(d,b.x,b.y,b.z,b.w)};case a.FLOAT_MAT4:return function(b){a.uniformMatrix4fv(d,!1,b.toFloat32Array())}}return function(){throw"Unknown uniform type: "+b;}}this.gl=a;var b=c(b),g=this.vshader=a.createShader(a.VERTEX_SHADER);a.shaderSource(g,d+b);a.compileShader(g);if(a.getShaderParameter(g,a.COMPILE_STATUS)!==!0)throw a.getShaderInfoLog(g);var q=this.fshader=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(q,f+b);a.compileShader(q);if(a.getShaderParameter(q,
a.COMPILE_STATUS)!==!0)throw a.getShaderInfoLog(q);var i=this.handle=a.createProgram();a.attachShader(i,g);a.attachShader(i,q);a.linkProgram(i);if(a.getProgramParameter(i,a.LINK_STATUS)!==!0)throw a.getProgramInfoLog(i);for(var j=a.getProgramParameter(i,a.ACTIVE_UNIFORMS),g=0;g<j;g++){var q=a.getActiveUniform(i,g),h=a.getUniformLocation(i,q.name);this["set_"+q.name]=m(q.type,h);this["loc_"+q.name]=h}j=a.getProgramParameter(i,a.ACTIVE_ATTRIBUTES);for(g=0;g<j;g++)q=a.getActiveAttrib(i,g),h=a.getAttribLocation(i,
q.name),this["loc_"+q.name]=h}var d="#ifdef GL_ES\nprecision highp float;\n#endif\n#define VERTEX\n",f="#ifdef GL_ES\nprecision highp float;\n#endif\n#define FRAGMENT\n",a={};b.prototype.use=function(){this.gl.useProgram(this.handle)};b.include=function(b,d){a[b]=d};return b}();
Embr.Vbo=function(){function c(b,d,c,a){function e(d,e,g){var h=b.createBuffer();b.bindBuffer(e,h);b.bufferData(e,g,c);Embr.Util.glCheckErr(b,"Error adding attribute '"+d+"'");var k=a[d],n=k.size!==void 0?k.size:1,l=k.location;k.location===void 0&&e===b.ARRAY_BUFFER&&(l=m++);F.attributes[d]={buffer:h,target:e,size:n,length:Math.floor(g.length/n),location:l}}this.gl=b;this.type=d;this.usage=c;this.attributes={};var F=this,m=0,g;for(g in a)d=a[g],g==="index"?e(g,b.ELEMENT_ARRAY_BUFFER,new Uint16Array(d.data)):
e(g,b.ARRAY_BUFFER,new Float32Array(d.data));if(!this.attributes.index)for(g in this.length=Number.MAX_VALUE,this.attributes)this.length=Math.min(this.length,this.attributes[g].length)}c.prototype.draw=function(){var b=this.gl,d;for(d in this.attributes){var c=this.attributes[d];c.target==b.ARRAY_BUFFER&&(b.bindBuffer(c.target,c.buffer),b.vertexAttribPointer(c.location,c.size,b.FLOAT,!1,0,0),b.enableVertexAttribArray(c.location))}(d=this.attributes.index)?(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.buffer),
b.drawElements(this.type,d.length,b.UNSIGNED_SHORT,0)):b.drawArrays(this.type,0,this.length)};c.prototype.destroy=function(){for(var b=this.gl,d=attributes.length;--d>=0;)b.deleteBuffer(attributes[d])};c.makePlane=function(b,d,c,a,e){return new Embr.Vbo(b,b.TRIANGLE_STRIP,b.STATIC_DRAW,{position:{data:[d,c,0,d,e,0,a,c,0,a,e,0],size:3},texcoord:{data:[0,0,0,1,1,0,1,1],size:2}})};c.makeCube=function(b,d,c,a){return new Embr.Vbo(b,b.TRIANGLES,b.STATIC_DRAW,{position:{data:[d,c,a,d,-c,a,d,-c,-a,d,c,-a,
d,c,a,d,c,-a,-d,c,-a,-d,c,a,d,c,a,-d,c,a,-d,-c,a,d,-c,a,-d,c,a,-d,c,-a,-d,-c,-a,-d,-c,a,-d,-c,-a,d,-c,-a,d,-c,a,-d,-c,a,d,-c,-a,-d,-c,-a,-d,c,-a,d,c,-a],size:3},normal:{data:[1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],size:3},texcoord:{data:[0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1],size:2},index:{data:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,
10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}})};return c}();
