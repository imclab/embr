var Embr=Embr!==void 0?Embr:{};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(f){window.setTimeout(f,1E3/60)}}();
Embr.run=function(f,b){var c=null;try{c=f.getContext("experimental-webgl")}catch(d){console.error(d)}if(c){console.log(["EMBR made a GL context!",c.getParameter(c.VERSION),c.getParameter(c.VENDOR),c.getParameter(c.RENDERER),c.getParameter(c.SHADING_LANGUAGE_VERSION)].join(" | "));b.gl=c;b.width=f.width=f.clientWidth;b.height=f.height=f.clientHeight;c.viewport(0,0,b.width,b.height);var a=null;b.framerate=function(e){a!==null&&clearInterval(a);e!==0&&(a=setInterval(function(){b._step()},1E3/e))};if(b.init)try{b.init()}catch(e){console.error("Exception caught in init: "+
e)}var J=0,g=Date.now(),l=!0;b._step=function(){if(b.step){b.frameid=J;b.frametime=(Date.now()-g)/1E3;try{b.step()}catch(a){console.error("Exception caught in step: "+a)}l=!0;J++}};b._draw=function(){if(b.draw&&l){try{b.draw()}catch(a){console.error("Exception caught in draw: "+a)}l=!1}window.requestAnimationFrame(b._draw,f)};b._step();b._draw();return b}};
(function(){function f(a,e,b){this.x=a;this.y=e;this.z=b}function b(a,e){this.x=a;this.y=e}function c(a,e,b,c){this.x=a;this.y=e;this.z=b;this.w=c}function d(){this.reset()}f.prototype.set=function(a,e,b){this.x=a;this.y=e;this.z=b;return this};f.prototype.setVec3=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};f.prototype.cross2=function(a,e){var b=a.x,c=a.y,d=a.z,f=e.x,i=e.y,j=e.z;this.x=c*j-d*i;this.y=d*f-b*j;this.z=b*i-c*f;return this};f.prototype.cross=function(a){return this.cross2(this,
a)};f.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};f.prototype.add2=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;this.z=a.z+e.z;return this};f.prototype.added2=function(a,e){return new f(a.x+e.x,a.y+e.y,a.z+e.z)};f.prototype.add=function(a){return this.add2(this,a)};f.prototype.added=function(a){return this.added2(this,a)};f.prototype.sub2=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;this.z=a.z-e.z;return this};f.prototype.subbed2=function(a,e){return new f(a.x-e.x,a.y-e.y,a.z-
e.z)};f.prototype.sub=function(a){return this.sub2(this,a)};f.prototype.subbed=function(a){return this.subbed2(this,a)};f.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};f.prototype.scaled=function(a){return new f(this.x*a,this.y*a,this.z*a)};f.prototype.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;this.z+=(a.z-this.z)*e;return this};f.prototype.lerped=function(a,e){return new f(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e,this.z+(a.z-this.z)*e)};f.prototype.length=
function(){var a=this.x,e=this.y,b=this.z;return Math.sqrt(a*a+e*e+b*b)};f.prototype.lengthSquared=function(){var a=this.x,e=this.y,b=this.z;return a*a+e*e+b*b};f.prototype.normalize=function(){return this.scale(1/this.length())};f.prototype.normalized=function(){return this.dup().normalize()};f.prototype.dup=function(){return new f(this.x,this.y,this.z)};f.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z};b.prototype.set=function(a,e){this.x=a;this.y=e;return this};
b.prototype.setVec2=function(a){this.x=a.x;this.y=a.y;return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.add2=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;return this};b.prototype.added2=function(a,e){return new b(a.x+e.x,a.y+e.y)};b.prototype.add=function(a){return this.add2(this,a)};b.prototype.added=function(a){return this.added2(this,a)};b.prototype.sub2=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;return this};b.prototype.subbed2=function(a,e){return new b(a.x-e.x,
a.y-e.y)};b.prototype.sub=function(a){return this.sub2(this,a)};b.prototype.subbed=function(a){return this.subbed2(this,a)};b.prototype.scale=function(a){this.x*=a;this.y*=a;return this};b.prototype.scaled=function(a){return new b(this.x*a,this.y*a)};b.prototype.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;return this};b.prototype.lerped=function(a,e){return new b(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e)};b.prototype.length=function(){var a=this.x,e=this.y;return Math.sqrt(a*
a+e*e)};b.prototype.lengthSquared=function(){var a=this.x,e=this.y;return a*a+e*e};b.prototype.normalize=function(){return this.scale(1/this.length())};b.prototype.normalized=function(){return this.dup().normalize()};b.prototype.dup=function(){return new b(this.x,this.y)};b.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y};c.prototype.set=function(a,e,b,c){this.x=a;this.y=e;this.z=b;this.w=c;return this};c.prototype.setVec4=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;
return this};c.prototype.dup=function(){return new c(this.x,this.y,this.z,this.w)};c.prototype.toVec3=function(){return new f(this.x,this.y,this.z)};d.prototype.set4x4r=function(a,e,b,c,d,f,i,j,h,r,m,n,q,o,p,t){this.a11=a;this.a12=e;this.a13=b;this.a14=c;this.a21=d;this.a22=f;this.a23=i;this.a24=j;this.a31=h;this.a32=r;this.a33=m;this.a34=n;this.a41=q;this.a42=o;this.a43=p;this.a44=t;return this};d.prototype.reset=function(){this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};d.prototype.mul2=
function(a,e){var b=a.a11,c=a.a12,d=a.a13,f=a.a14,i=a.a21,j=a.a22,h=a.a23,r=a.a24,m=a.a31,n=a.a32,q=a.a33,o=a.a34,p=a.a41,t=a.a42,s=a.a43,v=a.a44,u=e.a11,z=e.a12,x=e.a13,C=e.a14,D=e.a21,y=e.a22,E=e.a23,A=e.a24,B=e.a31,F=e.a32,w=e.a33,G=e.a34,H=e.a41,I=e.a42,K=e.a43,L=e.a44;this.a11=b*u+c*D+d*B+f*H;this.a12=b*z+c*y+d*F+f*I;this.a13=b*x+c*E+d*w+f*K;this.a14=b*C+c*A+d*G+f*L;this.a21=i*u+j*D+h*B+r*H;this.a22=i*z+j*y+h*F+r*I;this.a23=i*x+j*E+h*w+r*K;this.a24=i*C+j*A+h*G+r*L;this.a31=m*u+n*D+q*B+o*H;this.a32=
m*z+n*y+q*F+o*I;this.a33=m*x+n*E+q*w+o*K;this.a34=m*C+n*A+q*G+o*L;this.a41=p*u+t*D+s*B+v*H;this.a42=p*z+t*y+s*F+v*I;this.a43=p*x+t*E+s*w+v*K;this.a44=p*C+t*A+s*G+v*L;return this};d.prototype.mul=function(a){return this.mul2(this,a)};d.prototype.mul4x4r=function(a,e,b,c,d,f,i,j,h,r,m,n,q,o,p,t){var s=this.a11,v=this.a12,u=this.a13,z=this.a14,x=this.a21,C=this.a22,D=this.a23,y=this.a24,E=this.a31,A=this.a32,B=this.a33,F=this.a34,w=this.a41,G=this.a42,H=this.a43,I=this.a44;this.a11=s*a+v*d+u*h+z*q;this.a12=
s*e+v*f+u*r+z*o;this.a13=s*b+v*i+u*m+z*p;this.a14=s*c+v*j+u*n+z*t;this.a21=x*a+C*d+D*h+y*q;this.a22=x*e+C*f+D*r+y*o;this.a23=x*b+C*i+D*m+y*p;this.a24=x*c+C*j+D*n+y*t;this.a31=E*a+A*d+B*h+F*q;this.a32=E*e+A*f+B*r+F*o;this.a33=E*b+A*i+B*m+F*p;this.a34=E*c+A*j+B*n+F*t;this.a41=w*a+G*d+H*h+I*q;this.a42=w*e+G*f+H*r+I*o;this.a43=w*b+G*i+H*m+I*p;this.a44=w*c+G*j+H*n+I*t;return this};d.prototype.rotate=function(a,e,b,c){var d=Math.sin(a),a=Math.cos(a);this.mul4x4r(e*e*(1-a)+a,e*b*(1-a)-c*d,e*c*(1-a)+b*d,
0,b*e*(1-a)+c*d,b*b*(1-a)+a,b*c*(1-a)-e*d,0,e*c*(1-a)-b*d,b*c*(1-a)+e*d,c*c*(1-a)+a,0,0,0,0,1);return this};d.prototype.translate=function(a,e,b){this.mul4x4r(1,0,0,a,0,1,0,e,0,0,1,b,0,0,0,1);return this};d.prototype.scale=function(a,e,b){this.mul4x4r(a,0,0,0,0,e,0,0,0,0,b,0,0,0,0,1);return this};d.prototype.lookAt=function(a,e,b,c,d,k,i,j,h){c=(new f(a-c,e-d,b-k)).normalize();i=(new f(i,j,h)).cross(c).normalize();j=c.dup().cross(i).normalize();this.mul4x4r(i.x,i.y,i.z,0,j.x,j.y,j.z,0,c.x,c.y,c.z,
0,0,0,0,1);this.translate(-a,-e,-b);return this};d.prototype.frustum=function(a,b,c,d,f,k){this.mul4x4r((f+f)/(b-a),0,(b+a)/(b-a),0,0,(f+f)/(d-c),(d+c)/(d-c),0,0,0,(k+f)/(f-k),2*k*f/(f-k),0,0,-1,0);return this};d.prototype.perspective=function(a,b,c,d){a=1/Math.tan(a*Math.PI/360);this.mul4x4r(a/b,0,0,0,0,a,0,0,0,0,(d+c)/(c-d),2*c*d/(c-d),0,0,-1,0);return this};d.prototype.ortho=function(a,b,c,d,f,k){this.mul4x4r(2/(b-a),0,0,(b+a)/(a-b),0,2/(d-c),0,(d+c)/(c-d),0,0,2/(f-k),(k+f)/(f-k),0,0,0,1);return this};
d.prototype.invert=function(){var a=this.a11,b=this.a12,c=this.a13,d=this.a14,f=this.a21,k=this.a22,i=this.a23,j=this.a24,h=this.a31,r=this.a32,m=this.a33,n=this.a34,q=this.a41,o=this.a42,p=this.a43,t=this.a44,s=a*k-b*f,v=a*i-c*f,u=a*j-d*f,z=b*i-c*k,x=b*j-d*k,C=c*j-d*i,D=h*o-r*q,y=h*p-m*q,E=h*t-n*q,A=r*p-m*o,B=r*t-n*o,F=m*t-n*p,w=1/(s*F-v*B+u*A+z*E-x*y+C*D);this.a11=(+k*F-i*B+j*A)*w;this.a12=(-b*F+c*B-d*A)*w;this.a13=(+o*C-p*x+t*z)*w;this.a14=(-r*C+m*x-n*z)*w;this.a21=(-f*F+i*E-j*y)*w;this.a22=(+a*
F-c*E+d*y)*w;this.a23=(-q*C+p*u-t*v)*w;this.a24=(+h*C-m*u+n*v)*w;this.a31=(+f*B-k*E+j*D)*w;this.a32=(-a*B+b*E-d*D)*w;this.a33=(+q*x-o*u+t*s)*w;this.a34=(-h*x+r*u-n*s)*w;this.a41=(-f*A+k*y-i*D)*w;this.a42=(+a*A-b*y+c*D)*w;this.a43=(-q*z+o*v-p*s)*w;this.a44=(+h*z-r*v+m*s)*w;return this};d.prototype.transpose=function(){var a=this.a12,b=this.a13,c=this.a14,d=this.a21,f=this.a22,k=this.a23,i=this.a24,j=this.a31,h=this.a32,r=this.a33,m=this.a34,n=this.a41,q=this.a42,o=this.a43,p=this.a44;this.a11=this.a11;
this.a12=d;this.a13=j;this.a14=n;this.a21=a;this.a22=f;this.a23=h;this.a24=q;this.a31=b;this.a32=k;this.a33=r;this.a34=o;this.a41=c;this.a42=i;this.a43=m;this.a44=p;return this};d.prototype.mulVec3=function(a){var b=a.x,c=a.y,a=a.z;return new f(this.a14+this.a11*b+this.a12*c+this.a13*a,this.a24+this.a21*b+this.a22*c+this.a23*a,this.a34+this.a31*b+this.a32*c+this.a33*a)};d.prototype.mulVec4=function(a){var b=a.x,d=a.y,f=a.z,a=a.w;return new c(this.a14*a+this.a11*b+this.a12*d+this.a13*f,this.a24*a+
this.a21*b+this.a22*d+this.a23*f,this.a34*a+this.a31*b+this.a32*d+this.a33*f,this.a44*a+this.a41*b+this.a42*d+this.a43*f)};d.prototype.dup=function(){var a=new d;a.set4x4r(this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44);return a};d.prototype.toFloat32Array=function(){return new Float32Array([this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,
this.a24,this.a34,this.a44])};d.prototype.debugString=function(){for(var a=[this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44],b=[0,0,0,0],c=0;c<16;++c){a[c]+="";var d=a[c].length,f=c&3;b[f]<d&&(b[f]=d)}f="";for(c=0;c<16;++c){d=a[c].length;for(d=b[c&3]-d;d--;)f+=" ";f+=a[c]+((c&3)===3?"\n":"  ")}return f};Embr.Vec2=b;Embr.Vec3=f;Embr.Vec4=c;Embr.Mat4=d})();
Embr.Util=function(){function f(b){var a={},c;for(c in b)a[c]=b[c]instanceof Object?f(b[c]):b[c];return a}function b(c,a){if(a===void 0)return f(c);var e,J={},g;for(g in c)e=g in a?a[g]:c[g],J[g]=e instanceof Object?b(c[g],a[g]):e;return J}var c=null;return{glCheckErr:function(b,a){var e=b.getError();if(e!==b.NO_ERROR){if(c===null){c={};for(var f in b)typeof b[f]=="number"&&(c[b[f]]=f)}throw a+" ("+c[e]+")";}},mergeOptions:b}}();Embr.rand=function(f){return Math.random()*f};
Embr.rand2=function(f,b){return f+Math.random()*(b-f)};Embr.randSym=function(f){return f*2*Math.random()-f};(function(){Embr.kPI=Math.PI;Embr.kPI2=Math.PI/2;Embr.kPI4=Math.PI/4;var f=Embr.k2PI=Math.PI*2;Embr.randVec3=function(b){var c=Math.random()*f,d=Math.random()*2-1,a=Math.sqrt(1-d*d);return new Embr.Vec3(a*Math.cos(c)*b,a*Math.sin(c)*b,d*b)}})();
Embr.Quat=function(){function f(){this.reset()}var b=Math.pow(2,-24);f.prototype.set=function(b,d,a,e){this.x=b;this.y=d;this.z=a;this.w=e;return this};f.prototype.reset=function(){return this.set(0,0,0,1)};f.prototype.length=function(){var b=this.x,d=this.y,a=this.z,e=this.w;return Math.sqrt(b*b+d*d+a*a+e*e)};f.prototype.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w};f.prototype.mult2=function(b,d){var a=b.x,e=b.y,f=b.z,g=b.w,l=d.x,k=d.y,i=d.z,j=d.w;this.x=j*a+l*g+k*f-i*e;this.y=
j*e+k*g+i*a-l*f;this.z=j*f+i*g+l*e-k*a;this.w=j*g-l*a-k*e-i*f;return this};f.prototype.mult=function(b){return this.mult2(this,b)};f.prototype.mult4=function(b,d,a,e){var f=this.x,g=this.y,l=this.z,k=this.w;this.x=e*f+b*k+d*l-a*g;this.y=e*g+d*k+a*f-b*l;this.z=e*l+a*k+b*g-d*f;this.w=e*k-b*f-d*g-a*l;return this};f.prototype.normalize=function(){var c=this.length();c>b&&(this.x/=c,this.y/=c,this.z/=c,this.w/=c);return this};f.prototype.rotate=function(c,d,a,e){var f=Math.sqrt(d*d+a*a+e*e);if(f>b){c/=
2;var g=Math.sin(c);this.mult4(d/f*g,a/f*g,e/f*g,Math.cos(c))}return this};f.prototype.toMat4=function(){var b=this.x+this.x,d=this.y+this.y,a=this.z+this.z,e=this.w*b,f=this.w*d,g=this.w*a;b*=this.x;var l=this.x*d,k=this.x*a;d*=this.y;var i=this.y*a;a*=this.z;return(new Embr.Mat4).set4x4r(1-(d+a),l-g,k+f,0,l+g,1-(b+a),i-e,0,k-f,i+e,1-(b+d),0,0,0,0,1)};f.prototype.dup=function(){return(new f).set(this.x,this.y,this.z,this.w)};return f}();
Embr.Noise=function(){for(var f=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,
73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,
222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=Array(512),d=0;d<512;d++)c[d]=b[d&255];var a=0.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,J=1/3,g=1/6;return{sn2:function(b,d){var i,j,h;h=(b+d)*a;var g=Math.floor(b+h),m=Math.floor(d+h);h=(g+m)*e;i=b-(g-h);var n=d-(m-h),q,o;i>n?(q=1,o=0):(q=0,o=1);j=i-q+e;var p=n-o+e;h=i-1+2*e;var t=n-1+2*e,s=g&255;m&=255;g=c[s+c[m]]%12;q=c[s+q+c[m+o]]%12;o=c[s+1+c[m+1]]%12;s=0.5-i*i-n*n;s<0?i=0:(s*=s,i=s*s*(f[g][0]*i+f[g][1]*n));n=0.5-j*j-p*p;n<0?j=0:(n*=
n,j=n*n*(f[q][0]*j+f[q][1]*p));p=0.5-h*h-t*t;p<0?h=0:(p*=p,h=p*p*(f[o][0]*h+f[o][1]*t));return 70*(i+j+h)},sn3:function(a,b,d){var e,h,r=(a+b+d)*J,m=Math.floor(a+r),n=Math.floor(b+r),q=Math.floor(d+r),r=(m+n+q)*g;e=a-(m-r);h=b-(n-r);var o=d-(q-r),p,t,s,v,u,z;e>=h?h>=o?(p=1,s=t=0,u=v=1,z=0):(e>=o?(p=1,s=t=0):(t=p=0,s=1),v=1,u=0,z=1):h<o?(t=p=0,s=1,v=0,z=u=1):e<o?(p=0,t=1,v=s=0,z=u=1):(p=0,t=1,s=0,u=v=1,z=0);var x=e-p+g,C=h-t+g,D=o-s+g,a=e-v+2*g,y=h-u+2*g,E=o-z+2*g,d=e-1+3*g,b=h-1+3*g,r=o-1+3*g;m&=
255;var A=n&255,B=q&255,n=c[m+c[A+c[B]]]%12,q=c[m+p+c[A+t+c[B+s]]]%12;v=c[m+v+c[A+u+c[B+z]]]%12;m=c[m+1+c[A+1+c[B+1]]]%12;u=0.6-e*e-h*h-o*o;u<0?e=0:(u*=u,e=u*u*(f[n][0]*e+f[n][1]*h+f[n][2]*o));h=0.6-x*x-C*C-D*D;h<0?h=0:(h*=h,h=h*h*(f[q][0]*x+f[q][1]*C+f[q][2]*D));x=0.6-a*a-y*y-E*E;x<0?a=0:(x*=x,a=x*x*(f[v][0]*a+f[v][1]*y+f[v][2]*E));y=0.6-d*d-b*b-r*r;y<0?d=0:(y*=y,d=y*y*(f[m][0]*d+f[m][1]*b+f[m][2]*r));return 32*(e+h+a+d)}}}();
Embr.Texture=function(){function f(b,c,d,a,e){this.width=c;this.height=heigth;e===void 0&&(e={});var a=e.filter_min!==void 0?e.filter_min:b.NEAREST,f=e.filter_mag!==void 0?e.filter_mag:b.NEAREST,g=e.wrap_s!==void 0?e.wrap_s:b.CLAMP_TO_EDGE,l=e.wrap_t!==void 0?e.wrap_t:b.CLAMP_TO_EDGE;this.target=e.target!==void 0?e.target:b.TEXTURE_2D;this.format=e.format!==void 0?e.format:b.RGBA;this.formati=e.formati!==void 0?e.formati:b.RGBA;this.type=e.type!==void 0?e.type:b.UNSIGNED_BYTE;this.handle=b.createTexture();
b.bindTexture(this.target,this.handle);b.texImage2D(target,0,this.formati,c,d,0,this.format,type,tex_data);b.texParameteri(this.target,b.TEXTURE_MIN_FILTER,a);b.texParameteri(this.target,b.TEXTURE_MAG_FILTER,f);b.texParameteri(this.target,b.TEXTURE_WRAP_S,g);b.texParameteri(this.target,b.TEXTURE_WRAP_T,l)}f.prototype.bind=function(b){var c=this.gl;b!==void 0&&c.activeTexture(c.TEXTURE0+b);c.bindTexture(this.target,obj)};f.prototype.unbind=function(b){var c=this.gl;b!==void 0&&c.activeTexture(c.TEXTURE0+
b);c.bindTexture(this.target,null)};f.prototype.update=function(b){var c=this.gl;c.bindTexture(this.target,this.handle);c.texSubImage2D(this.target,0,0,0,this.width,this.height,this.format,this.type,b)};return f}();
Embr.Fbo=function(){function f(b,c,d,a){this.gl=b;this.width=c;this.height=d;this.tex_attachments=[];this.render_attachments=[];this.handle=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,this.handle);for(var e=0,f=a.length,g=0;e<f;e++){var l=a[e],k=l.target!==void 0?l.target:b.TEXTURE_2D,i=l.formati!==void 0?l.formati:b.RGBA,j=l.attach!==void 0?l.attach:b.COLOR_ATTACHMENT0+g++;if(k==b.RENDERBUFFER){var h=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,h);b.renderbufferStorage(k,i,
c,d);b.framebufferRenderbuffer(b.FRAMEBUFFER,j,k,h);this.render_attachments.push({handle:h})}else{var h=l.format!==void 0?l.format:b.RGBA,r=l.type!==void 0?l.type:b.UNSIGNED_BYTE,m=l.filter_min!==void 0?l.filter_min:b.NEAREST,n=l.filter_mag!==void 0?l.filter_mag:b.NEAREST,q=l.wrap_s!==void 0?l.wrap_s:b.CLAMP_TO_EDGE,l=l.wrap_t!==void 0?l.wrap_t:b.CLAMP_TO_EDGE,o=b.createTexture();b.bindTexture(k,o);b.texImage2D(k,0,i,c,d,0,h,r,null);b.texParameteri(k,b.TEXTURE_MIN_FILTER,m);b.texParameteri(k,b.TEXTURE_MAG_FILTER,
n);b.texParameteri(k,b.TEXTURE_WRAP_S,q);b.texParameteri(k,b.TEXTURE_WRAP_T,l);b.framebufferTexture2D(b.FRAMEBUFFER,j,k,o,0);this.tex_attachments.push({handle:o,target:k,unit:b.TEXTURE0})}}if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw"Incomplete frame buffer object.";b.bindFramebuffer(b.FRAMEBUFFER,null)}f.prototype.bind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.handle)};f.prototype.unbind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,null)};
f.prototype.bindTexture=function(b,c){var d=this.gl,a=this.tex_attachments[b];if(c!==void 0)a.unit=d.TEXTURE0+c;d.activeTexture(a.unit);d.bindTexture(a.target,a.handle)};f.prototype.unbindTexture=function(b){var c=this.gl,b=this.tex_attachments[b];c.activeTexture(b.unit);c.bindTexture(b.target,null)};return f}();
Embr.PingPong=function(){function f(b,c,d,a){this.wbuffer=new Embr.Fbo(b,c,d,a);this.rbuffer=new Embr.Fbo(b,c,d,a);this.swap()}f.prototype.swap=function(){var b=this.wbuffer;this.wbuffer=this.rbuffer;this.rbuffer=b};f.prototype.bind=function(){this.wbuffer.bind()};f.prototype.unbind=function(){this.wbuffer.unbind()};f.prototype.bindTexture=function(){this.rbuffer.bindTexture.apply(this.rbuffer,arguments)};f.prototype.unbindTexture=function(){this.rbuffer.unbindTexture.apply(this.rbuffer,arguments)};
return f}();
Embr.Vbo=function(){function f(b,c,d,a){function e(c,e,g){var j=b.createBuffer();b.bindBuffer(e,j);b.bufferData(e,g,d);Embr.Util.glCheckErr(b,"Error adding attribute '"+c+"'");var h=a[c],r=h.size!==void 0?h.size:1,m=h.location;h.location===void 0&&e===b.ARRAY_BUFFER&&(m=-1);f.attributes[c]={buffer:j,target:e,size:r,length:Math.floor(g.length/r),location:m}}this.gl=b;this.type=c;this.usage=d;this.attributes={};var f=this,g;for(g in a)g==="index"?e(g,b.ELEMENT_ARRAY_BUFFER,new Uint16Array(a[g].data)):e(g,
b.ARRAY_BUFFER,new Float32Array(a[g].data));if(!this.attributes.index)for(g in this.length=Number.MAX_VALUE,this.attributes)this.length=Math.min(this.length,this.attributes[g].length)}f.prototype.draw=function(){var b=this.gl,c;for(c in this.attributes){var d=this.attributes[c];d.target==b.ARRAY_BUFFER&&d.location>=0&&(b.bindBuffer(d.target,d.buffer),b.vertexAttribPointer(d.location,d.size,b.FLOAT,!1,0,0),b.enableVertexAttribArray(d.location))}(c=this.attributes.index)?(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
c.buffer),b.drawElements(this.type,c.length,b.UNSIGNED_SHORT,0)):b.drawArrays(this.type,0,this.length)};f.prototype.destroy=function(){for(var b=this.gl,c=attributes.length;--c>=0;)b.deleteBuffer(attributes[c])};f.makePlane=function(b,c,d,a,e){return new Embr.Vbo(b,b.TRIANGLE_STRIP,b.STATIC_DRAW,{position:{data:[c,d,0,c,e,0,a,d,0,a,e,0],size:3},texcoord:{data:[0,0,0,1,1,0,1,1],size:2}})};f.makeCube=function(b,c,d,a){return new Embr.Vbo(b,b.TRIANGLES,b.STATIC_DRAW,{position:{data:[c,d,a,c,-d,a,c,-d,
-a,c,d,-a,c,d,a,c,d,-a,-c,d,-a,-c,d,a,c,d,a,-c,d,a,-c,-d,a,c,-d,a,-c,d,a,-c,d,-a,-c,-d,-a,-c,-d,a,-c,-d,-a,c,-d,-a,c,-d,a,-c,-d,a,c,-d,-a,-c,-d,-a,-c,d,-a,c,d,-a],size:3},normal:{data:[1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],size:3},texcoord:{data:[0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1],size:2},index:{data:[0,1,2,0,2,3,4,5,6,
4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}})};return f}();
Embr.Program=function(){function f(c,d,a){this.gl=c;var e=this.shader_vert=c.createShader(c.VERTEX_SHADER);c.shaderSource(e,b+d);c.compileShader(e);if(c.getShaderParameter(e,c.COMPILE_STATUS)!==!0)throw c.getShaderInfoLog(e);d=this.shader_frag=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,b+a);c.compileShader(d);if(c.getShaderParameter(d,c.COMPILE_STATUS)!==!0)throw c.getShaderInfoLog(d);this.handle=c.createProgram()}var b="#ifdef GL_ES\nprecision highp float;\n#endif\n";f.prototype.link=function(){function b(a,
c){switch(a){case d.BOOL:case d.INT:case d.SAMPLER_2D:case d.SAMPLER_CUBE:return function(a){d.uniform1i(c,a);return this};case d.FLOAT:return function(a){d.uniform1f(c,a);return this};case d.FLOAT_VEC2:return function(a){d.uniform2f(c,a.x,a.y)};case d.FLOAT_VEC3:return function(a){d.uniform3f(c,a.x,a.y,a.z)};case d.FLOAT_VEC4:return function(a){d.uniform4f(c,a.x,a.y,a.z,a.w)};case d.FLOAT_MAT4:return function(a){d.uniformMatrix4fv(c,!1,a.toFloat32Array())}}return function(){throw"Unknown uniform type: "+
a;}}var d=this.gl,a=this.handle;d.attachShader(a,this.shader_vert);d.attachShader(a,this.shader_frag);d.linkProgram(a);if(d.getProgramParameter(a,d.LINK_STATUS)!==!0)throw d.getProgramInfoLog(a);this.uniforms={};this.locations={};for(var e=d.getProgramParameter(a,d.ACTIVE_UNIFORMS),f=0;f<e;++f){var g=d.getActiveUniform(a,f),l=d.getUniformLocation(a,g.name);this.uniforms[g.name]=b(g.type,l);this.locations[g.name]=l}e=d.getProgramParameter(a,d.ACTIVE_ATTRIBUTES);for(f=0;f<e;++f)g=d.getActiveAttrib(a,
f),l=d.getAttribLocation(a,g.name),this.locations[g.name]=l};f.prototype.use=function(){this.gl.useProgram(this.handle)};f.prototype.useUniforms=function(b){this.use();var d=this.uniforms,a;for(a in b)d[a](b[a])};f.prototype.dispose=function(){this.gl.deleteShader(this.shader_vert);this.gl.deleteShader(this.shader_frag);this.gl.deleteProgram(this.handle)};return f}();
Embr.Material=function(){function f(b,c,d,a){if(a&&a.flags){var e="",f;for(f in a.flags)a.flags[f]&&(e+="#define "+f+"\n");c=e+c;d=e+d}Embr.Program.call(this,b,c,d);this.link();this.attribute_locations={};if(a&&a.attributes)for(var g in a.attributes)b=a.attributes[g],b in this.locations&&(this.attribute_locations[g]=this.locations[b])}f.prototype=Object.create(Embr.Program.prototype);f.prototype.assignLocations=function(b){for(var c in b.attributes)b.attributes[c].location=c in this.attribute_locations?
this.attribute_locations[c]:-1};return f}();
Embr.ColorMaterial=function(){function f(a,e){e=Embr.Util.mergeOptions(d,e);Embr.Material.call(this,a,b,c,e)}var b="uniform mat4 modelview, projection;\nattribute vec3 a_position;\n#ifdef use_vertex_color\nattribute vec4 a_color;\nvarying vec4 v_color;\n#endif\nvoid main(){\n#ifdef use_vertex_color\nv_color = a_color;\n#endif\ngl_Position = projection * modelview * vec4(a_position, 1.0);\n}",c="uniform vec4 color;\n#ifdef use_vertex_color\nvarying vec4 v_color;\n#endif\nvoid main(){\n#ifdef use_vertex_color\ngl_FragColor = v_color * color;\n#else\ngl_FragColor = color;\n#endif\n}",d=
{attributes:{position:"a_position",color:"a_color"},flags:{use_vertex_color:!1}};f.prototype=Object.create(Embr.Material.prototype);return f}();
Embr.NormalMaterial=function(){function f(a,e){e=Embr.Util.mergeOptions(d,e);Embr.Material.call(this,a,b,c,e)}var b="uniform mat4 modelview, projection;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nvarying vec4 v_color;\nvoid main(){\nvec4 normal = modelview * vec4(a_normal, 0.0);\nv_color = vec4((normal.xyz + 1.0) * 0.5, 1.0);\ngl_Position = projection * modelview * vec4(a_position, 1.0);\n}",c="varying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}",d={attributes:{position:"a_position",
normal:"a_normal"}};f.prototype=Object.create(Embr.Material.prototype);return f}();
