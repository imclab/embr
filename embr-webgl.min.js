var Embr=Embr!==void 0?Embr:{};
Embr.run=function(d,b){var c=null;try{c=d.getContext("experimental-webgl")}catch(f){console.error(f)}if(c){console.log(["EMBR made a GL context!",c.getParameter(c.VERSION),c.getParameter(c.VENDOR),c.getParameter(c.RENDERER),c.getParameter(c.SHADING_LANGUAGE_VERSION)].join(" | "));b.gl=c;b.width=d.width=d.clientWidth;b.height=d.height=d.clientHeight;c.viewport(0,0,b.width,b.height);var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}(),e=null;b.framerate=function(a){e!==null&&clearInterval(e);a!==0&&(e=setInterval(function(){b._step()},1E3/a))};if(b.init)try{b.init()}catch(J){console.error("Exception caught in init: "+J)}var k=0,g=Date.now(),p=!0;b._step=function(){if(b.step){b.frameid=k;b.frametime=(Date.now()-g)/1E3;try{b.step()}catch(a){console.error("Exception caught in step: "+a)}p=!0;k++}};b._draw=function(){if(b.draw&&
p){try{b.draw()}catch(e){console.error("Exception caught in draw: "+e)}p=!1;a(b._draw,d)}};b._step();b._draw();return b}};
(function(){function d(a,e,b){this.x=a;this.y=e;this.z=b}function b(a,e){this.x=a;this.y=e}function c(a,e,b,c){this.x=a;this.y=e;this.z=b;this.w=c}function f(){this.reset()}d.prototype.set=function(a,e,b){this.x=a;this.y=e;this.z=b;return this};d.prototype.setVec3=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};d.prototype.cross2=function(a,e){var b=a.x,c=a.y,g=a.z,f=e.x,d=e.y,j=e.z;this.x=c*j-g*d;this.y=g*f-b*j;this.z=b*d-c*f;return this};d.prototype.cross=function(a){return this.cross2(this,
a)};d.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};d.prototype.add2=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;this.z=a.z+e.z;return this};d.prototype.added2=function(a,e){return new d(a.x+e.x,a.y+e.y,a.z+e.z)};d.prototype.add=function(a){return this.add2(this,a)};d.prototype.added=function(a){return this.added2(this,a)};d.prototype.sub2=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;this.z=a.z-e.z;return this};d.prototype.subbed2=function(a,e){return new d(a.x-e.x,a.y-e.y,a.z-
e.z)};d.prototype.sub=function(a){return this.sub2(this,a)};d.prototype.subbed=function(a){return this.subbed2(this,a)};d.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};d.prototype.scaled=function(a){return new d(this.x*a,this.y*a,this.z*a)};d.prototype.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;this.z+=(a.z-this.z)*e;return this};d.prototype.lerped=function(a,e){return new d(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e,this.z+(a.z-this.z)*e)};d.prototype.length=
function(){var a=this.x,e=this.y,b=this.z;return Math.sqrt(a*a+e*e+b*b)};d.prototype.lengthSquared=function(){var a=this.x,e=this.y,b=this.z;return a*a+e*e+b*b};d.prototype.normalize=function(){return this.scale(1/this.length())};d.prototype.normalized=function(){return this.dup().normalize()};d.prototype.dup=function(){return new d(this.x,this.y,this.z)};d.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z};b.prototype.set=function(a,e){this.x=a;this.y=e;return this};
b.prototype.setVec2=function(a){this.x=a.x;this.y=a.y;return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.add2=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;return this};b.prototype.added2=function(a,e){return new b(a.x+e.x,a.y+e.y)};b.prototype.add=function(a){return this.add2(this,a)};b.prototype.added=function(a){return this.added2(this,a)};b.prototype.sub2=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;return this};b.prototype.subbed2=function(a,e){return new b(a.x-e.x,
a.y-e.y)};b.prototype.sub=function(a){return this.sub2(this,a)};b.prototype.subbed=function(a){return this.subbed2(this,a)};b.prototype.scale=function(a){this.x*=a;this.y*=a;return this};b.prototype.scaled=function(a){return new b(this.x*a,this.y*a)};b.prototype.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;return this};b.prototype.lerped=function(a,e){return new b(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e)};b.prototype.length=function(){var a=this.x,e=this.y;return Math.sqrt(a*
a+e*e)};b.prototype.lengthSquared=function(){var a=this.x,e=this.y;return a*a+e*e};b.prototype.normalize=function(){return this.scale(1/this.length())};b.prototype.normalized=function(){return this.dup().normalize()};b.prototype.dup=function(){return new b(this.x,this.y)};b.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y};c.prototype.set=function(a,e,b,c){this.x=a;this.y=e;this.z=b;this.w=c;return this};c.prototype.setVec4=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;
return this};c.prototype.dup=function(){return new c(this.x,this.y,this.z,this.w)};c.prototype.toVec3=function(){return new d(this.x,this.y,this.z)};f.prototype.set4x4r=function(a,e,b,c,g,f,d,j,h,l,n,m,t,o,q,s){this.a11=a;this.a12=e;this.a13=b;this.a14=c;this.a21=g;this.a22=f;this.a23=d;this.a24=j;this.a31=h;this.a32=l;this.a33=n;this.a34=m;this.a41=t;this.a42=o;this.a43=q;this.a44=s;return this};f.prototype.reset=function(){this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};f.prototype.mul2=
function(a,e){var b=a.a11,c=a.a12,g=a.a13,f=a.a14,d=a.a21,j=a.a22,h=a.a23,l=a.a24,n=a.a31,m=a.a32,t=a.a33,o=a.a34,q=a.a41,s=a.a42,r=a.a43,v=a.a44,u=e.a11,z=e.a12,x=e.a13,C=e.a14,D=e.a21,y=e.a22,E=e.a23,A=e.a24,B=e.a31,F=e.a32,w=e.a33,G=e.a34,H=e.a41,I=e.a42,K=e.a43,L=e.a44;this.a11=b*u+c*D+g*B+f*H;this.a12=b*z+c*y+g*F+f*I;this.a13=b*x+c*E+g*w+f*K;this.a14=b*C+c*A+g*G+f*L;this.a21=d*u+j*D+h*B+l*H;this.a22=d*z+j*y+h*F+l*I;this.a23=d*x+j*E+h*w+l*K;this.a24=d*C+j*A+h*G+l*L;this.a31=n*u+m*D+t*B+o*H;this.a32=
n*z+m*y+t*F+o*I;this.a33=n*x+m*E+t*w+o*K;this.a34=n*C+m*A+t*G+o*L;this.a41=q*u+s*D+r*B+v*H;this.a42=q*z+s*y+r*F+v*I;this.a43=q*x+s*E+r*w+v*K;this.a44=q*C+s*A+r*G+v*L;return this};f.prototype.mul=function(a){return this.mul2(this,a)};f.prototype.mul4x4r=function(a,e,b,c,g,f,d,j,h,l,n,m,t,o,q,s){var r=this.a11,v=this.a12,u=this.a13,z=this.a14,x=this.a21,C=this.a22,D=this.a23,y=this.a24,E=this.a31,A=this.a32,B=this.a33,F=this.a34,w=this.a41,G=this.a42,H=this.a43,I=this.a44;this.a11=r*a+v*g+u*h+z*t;this.a12=
r*e+v*f+u*l+z*o;this.a13=r*b+v*d+u*n+z*q;this.a14=r*c+v*j+u*m+z*s;this.a21=x*a+C*g+D*h+y*t;this.a22=x*e+C*f+D*l+y*o;this.a23=x*b+C*d+D*n+y*q;this.a24=x*c+C*j+D*m+y*s;this.a31=E*a+A*g+B*h+F*t;this.a32=E*e+A*f+B*l+F*o;this.a33=E*b+A*d+B*n+F*q;this.a34=E*c+A*j+B*m+F*s;this.a41=w*a+G*g+H*h+I*t;this.a42=w*e+G*f+H*l+I*o;this.a43=w*b+G*d+H*n+I*q;this.a44=w*c+G*j+H*m+I*s;return this};f.prototype.rotate=function(a,e,b,c){var g=Math.sin(a),a=Math.cos(a);this.mul4x4r(e*e*(1-a)+a,e*b*(1-a)-c*g,e*c*(1-a)+b*g,
0,b*e*(1-a)+c*g,b*b*(1-a)+a,b*c*(1-a)-e*g,0,e*c*(1-a)-b*g,b*c*(1-a)+e*g,c*c*(1-a)+a,0,0,0,0,1);return this};f.prototype.translate=function(a,e,b){this.mul4x4r(1,0,0,a,0,1,0,e,0,0,1,b,0,0,0,1);return this};f.prototype.scale=function(a,e,b){this.mul4x4r(a,0,0,0,0,e,0,0,0,0,b,0,0,0,0,1);return this};f.prototype.lookAt=function(a,e,b,c,g,f,i,j,h){c=(new d(a-c,e-g,b-f)).normalize();i=(new d(i,j,h)).cross(c).normalize();j=c.dup().cross(i).normalize();this.mul4x4r(i.x,i.y,i.z,0,j.x,j.y,j.z,0,c.x,c.y,c.z,
0,0,0,0,1);this.translate(-a,-e,-b);return this};f.prototype.frustum=function(a,e,b,c,g,f){this.mul4x4r((g+g)/(e-a),0,(e+a)/(e-a),0,0,(g+g)/(c-b),(c+b)/(c-b),0,0,0,(f+g)/(g-f),2*f*g/(g-f),0,0,-1,0);return this};f.prototype.perspective=function(a,e,b,c){a=1/Math.tan(a*Math.PI/360);this.mul4x4r(a/e,0,0,0,0,a,0,0,0,0,(c+b)/(b-c),2*b*c/(b-c),0,0,-1,0);return this};f.prototype.ortho=function(a,e,b,c,f,d){this.mul4x4r(2/(e-a),0,0,(e+a)/(a-e),0,2/(c-b),0,(c+b)/(b-c),0,0,2/(f-d),(d+f)/(f-d),0,0,0,1);return this};
f.prototype.invert=function(){var a=this.a11,e=this.a12,b=this.a13,c=this.a14,f=this.a21,d=this.a22,i=this.a23,j=this.a24,h=this.a31,l=this.a32,n=this.a33,m=this.a34,t=this.a41,o=this.a42,q=this.a43,s=this.a44,r=a*d-e*f,v=a*i-b*f,u=a*j-c*f,z=e*i-b*d,x=e*j-c*d,C=b*j-c*i,D=h*o-l*t,y=h*q-n*t,E=h*s-m*t,A=l*q-n*o,B=l*s-m*o,F=n*s-m*q,w=1/(r*F-v*B+u*A+z*E-x*y+C*D);this.a11=(+d*F-i*B+j*A)*w;this.a12=(-e*F+b*B-c*A)*w;this.a13=(+o*C-q*x+s*z)*w;this.a14=(-l*C+n*x-m*z)*w;this.a21=(-f*F+i*E-j*y)*w;this.a22=(+a*
F-b*E+c*y)*w;this.a23=(-t*C+q*u-s*v)*w;this.a24=(+h*C-n*u+m*v)*w;this.a31=(+f*B-d*E+j*D)*w;this.a32=(-a*B+e*E-c*D)*w;this.a33=(+t*x-o*u+s*r)*w;this.a34=(-h*x+l*u-m*r)*w;this.a41=(-f*A+d*y-i*D)*w;this.a42=(+a*A-e*y+b*D)*w;this.a43=(-t*z+o*v-q*r)*w;this.a44=(+h*z-l*v+n*r)*w;return this};f.prototype.transpose=function(){var a=this.a12,e=this.a13,b=this.a14,c=this.a21,f=this.a22,d=this.a23,i=this.a24,j=this.a31,h=this.a32,l=this.a33,n=this.a34,m=this.a41,t=this.a42,o=this.a43,q=this.a44;this.a11=this.a11;
this.a12=c;this.a13=j;this.a14=m;this.a21=a;this.a22=f;this.a23=h;this.a24=t;this.a31=e;this.a32=d;this.a33=l;this.a34=o;this.a41=b;this.a42=i;this.a43=n;this.a44=q;return this};f.prototype.mulVec3=function(a){var b=a.x,c=a.y,a=a.z;return new d(this.a14+this.a11*b+this.a12*c+this.a13*a,this.a24+this.a21*b+this.a22*c+this.a23*a,this.a34+this.a31*b+this.a32*c+this.a33*a)};f.prototype.mulVec4=function(a){var b=a.x,f=a.y,d=a.z,a=a.w;return new c(this.a14*a+this.a11*b+this.a12*f+this.a13*d,this.a24*a+
this.a21*b+this.a22*f+this.a23*d,this.a34*a+this.a31*b+this.a32*f+this.a33*d,this.a44*a+this.a41*b+this.a42*f+this.a43*d)};f.prototype.dup=function(){var a=new f;a.set4x4r(this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44);return a};f.prototype.toFloat32Array=function(){return new Float32Array([this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,
this.a24,this.a34,this.a44])};f.prototype.debugString=function(){for(var a=[this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44],b=[0,0,0,0],c=0;c<16;++c){a[c]+="";var f=a[c].length,d=c&3;b[d]<f&&(b[d]=f)}d="";for(c=0;c<16;++c){f=a[c].length;for(f=b[c&3]-f;f--;)d+=" ";d+=a[c]+((c&3)===3?"\n":"  ")}return d};Embr.Vec2=b;Embr.Vec3=d;Embr.Vec4=c;Embr.Mat4=f})();
Embr.Util=function(){var d=null;return{glCheckErr:function(b,c){var f=b.getError();if(f!==b.NO_ERROR){if(d===null){d={};for(var a in b)typeof b[a]=="number"&&(d[b[a]]=a)}throw c+" ("+d[f]+")";}}}}();
Embr.Math=function(){var d=Math.PI*2;return{kPI:Math.PI,kPI2:Math.PI/2,kPI4:Math.PI/4,k2PI:d,rand:function(b,c){return b+Math.random()*(c-b)},randSym:function(b){return b*2*Math.random()-b},randVec3:function(b){var c=Math.random()*d,f=Math.random()*2-1,a=Math.sqrt(1-f*f);return new Embr.Vec3(a*Math.cos(c)*b,a*Math.sin(c)*b,f*b)}}}();
Embr.Quat=function(){function d(){this.reset()}var b=Math.pow(2,-24);d.prototype.set=function(b,f,a,e){this.x=b;this.y=f;this.z=a;this.w=e;return this};d.prototype.reset=function(){return this.set(0,0,0,1)};d.prototype.length=function(){var b=this.x,f=this.y,a=this.z,e=this.w;return Math.sqrt(b*b+f*f+a*a+e*e)};d.prototype.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w};d.prototype.mult2=function(b,f){var a=b.x,e=b.y,d=b.z,k=b.w,g=f.x,p=f.y,i=f.z,j=f.w;this.x=j*a+g*k+p*d-i*e;this.y=
j*e+p*k+i*a-g*d;this.z=j*d+i*k+g*e-p*a;this.w=j*k-g*a-p*e-i*d;return this};d.prototype.mult=function(b){return this.mult2(this,b)};d.prototype.mult4=function(b,f,a,e){var d=this.x,k=this.y,g=this.z,p=this.w;this.x=e*d+b*p+f*g-a*k;this.y=e*k+f*p+a*d-b*g;this.z=e*g+a*p+b*k-f*d;this.w=e*p-b*d-f*k-a*g;return this};d.prototype.normalize=function(){var c=this.length();c>b&&(this.x/=c,this.y/=c,this.z/=c,this.w/=c);return this};d.prototype.rotate=function(c,f,a,e){var d=Math.sqrt(f*f+a*a+e*e);if(d>b){c/=
2;var k=Math.sin(c);this.mult4(f/d*k,a/d*k,e/d*k,Math.cos(c))}return this};d.prototype.toMat4=function(){var b=this.x+this.x,d=this.y+this.y,a=this.z+this.z,e=this.w*b,J=this.w*d,k=this.w*a;b*=this.x;var g=this.x*d,p=this.x*a;d*=this.y;var i=this.y*a;a*=this.z;return(new Embr.Mat4).set4x4r(1-(d+a),g-k,p+J,0,g+k,1-(b+a),i-e,0,p-J,i+e,1-(b+d),0,0,0,0,1)};d.prototype.dup=function(){return(new d).set(this.x,this.y,this.z,this.w)};return d}();
Embr.Noise=function(){for(var d=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,
73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,
222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=Array(512),f=0;f<512;f++)c[f]=b[f&255];var a=0.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,J=1/3,k=1/6;return{sn2:function(b,f){var i,j,h;h=(b+f)*a;var l=Math.floor(b+h),n=Math.floor(f+h);h=(l+n)*e;i=b-(l-h);var m=f-(n-h),k,o;i>m?(k=1,o=0):(k=0,o=1);j=i-k+e;var q=m-o+e;h=i-1+2*e;var s=m-1+2*e,r=l&255;n&=255;l=c[r+c[n]]%12;k=c[r+k+c[n+o]]%12;o=c[r+1+c[n+1]]%12;r=0.5-i*i-m*m;r<0?i=0:(r*=r,i=r*r*(d[l][0]*i+d[l][1]*m));m=0.5-j*j-q*q;m<0?j=0:(m*=
m,j=m*m*(d[k][0]*j+d[k][1]*q));q=0.5-h*h-s*s;q<0?h=0:(q*=q,h=q*q*(d[o][0]*h+d[o][1]*s));return 70*(i+j+h)},sn3:function(a,b,e){var f,h,l=(a+b+e)*J,n=Math.floor(a+l),m=Math.floor(b+l),t=Math.floor(e+l),l=(n+m+t)*k;f=a-(n-l);h=b-(m-l);var o=e-(t-l),q,s,r,v,u,z;f>=h?h>=o?(q=1,r=s=0,u=v=1,z=0):(f>=o?(q=1,r=s=0):(s=q=0,r=1),v=1,u=0,z=1):h<o?(s=q=0,r=1,v=0,z=u=1):f<o?(q=0,s=1,v=r=0,z=u=1):(q=0,s=1,r=0,u=v=1,z=0);var x=f-q+k,C=h-s+k,D=o-r+k,a=f-v+2*k,y=h-u+2*k,E=o-z+2*k,e=f-1+3*k,b=h-1+3*k,l=o-1+3*k;n&=
255;var A=m&255,B=t&255,m=c[n+c[A+c[B]]]%12,t=c[n+q+c[A+s+c[B+r]]]%12;v=c[n+v+c[A+u+c[B+z]]]%12;n=c[n+1+c[A+1+c[B+1]]]%12;u=0.6-f*f-h*h-o*o;u<0?f=0:(u*=u,f=u*u*(d[m][0]*f+d[m][1]*h+d[m][2]*o));h=0.6-x*x-C*C-D*D;h<0?h=0:(h*=h,h=h*h*(d[t][0]*x+d[t][1]*C+d[t][2]*D));x=0.6-a*a-y*y-E*E;x<0?a=0:(x*=x,a=x*x*(d[v][0]*a+d[v][1]*y+d[v][2]*E));y=0.6-e*e-b*b-l*l;y<0?e=0:(y*=y,e=y*y*(d[n][0]*e+d[n][1]*b+d[n][2]*l));return 32*(f+h+a+e)}}}();
Embr.Texture=function(){function d(b,c,f,a,e){this.width=c;this.height=heigth;e===void 0&&(e={});var a=e.filter_min!==void 0?e.filter_min:b.NEAREST,d=e.filter_mag!==void 0?e.filter_mag:b.NEAREST,k=e.wrap_s!==void 0?e.wrap_s:b.CLAMP_TO_EDGE,g=e.wrap_t!==void 0?e.wrap_t:b.CLAMP_TO_EDGE;this.target=e.target!==void 0?e.target:b.TEXTURE_2D;this.format=e.format!==void 0?e.format:b.RGBA;this.formati=e.formati!==void 0?e.formati:b.RGBA;this.type=e.type!==void 0?e.type:b.UNSIGNED_BYTE;this.handle=b.createTexture();
b.bindTexture(this.target,this.handle);b.texImage2D(target,0,this.formati,c,f,0,this.format,type,tex_data);b.texParameteri(this.target,b.TEXTURE_MIN_FILTER,a);b.texParameteri(this.target,b.TEXTURE_MAG_FILTER,d);b.texParameteri(this.target,b.TEXTURE_WRAP_S,k);b.texParameteri(this.target,b.TEXTURE_WRAP_T,g)}d.prototype.bind=function(b){var c=this.gl;b!==void 0&&c.activeTexture(c.TEXTURE0+b);c.bindTexture(this.target,obj)};d.prototype.unbind=function(b){var c=this.gl;b!==void 0&&c.activeTexture(c.TEXTURE0+
b);c.bindTexture(this.target,null)};d.prototype.update=function(b){var c=this.gl;c.bindTexture(this.target,this.handle);c.texSubImage2D(this.target,0,0,0,this.width,this.height,this.format,this.type,b)};return d}();
Embr.Fbo=function(){function d(b,c,f,a){this.gl=b;this.width=c;this.height=f;this.tex_attachments=[];this.render_attachments=[];this.handle=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,this.handle);for(var e=0,d=a.length,k=0;e<d;e++){var g=a[e],p=g.target!==void 0?g.target:b.TEXTURE_2D,i=g.formati!==void 0?g.formati:b.RGBA,j=g.attach!==void 0?g.attach:b.COLOR_ATTACHMENT0+k++;if(p==b.RENDERBUFFER){var h=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,h);b.renderbufferStorage(p,i,
c,f);b.framebufferRenderbuffer(b.FRAMEBUFFER,j,p,h);this.render_attachments.push({handle:h})}else{var h=g.format!==void 0?g.format:b.RGBA,l=g.type!==void 0?g.type:b.UNSIGNED_BYTE,n=g.filter_min!==void 0?g.filter_min:b.NEAREST,m=g.filter_mag!==void 0?g.filter_mag:b.NEAREST,t=g.wrap_s!==void 0?g.wrap_s:b.CLAMP_TO_EDGE,g=g.wrap_t!==void 0?g.wrap_t:b.CLAMP_TO_EDGE,o=b.createTexture();b.bindTexture(p,o);b.texImage2D(p,0,i,c,f,0,h,l,null);b.texParameteri(p,b.TEXTURE_MIN_FILTER,n);b.texParameteri(p,b.TEXTURE_MAG_FILTER,
m);b.texParameteri(p,b.TEXTURE_WRAP_S,t);b.texParameteri(p,b.TEXTURE_WRAP_T,g);b.framebufferTexture2D(b.FRAMEBUFFER,j,p,o,0);this.tex_attachments.push({handle:o,target:p,unit:b.TEXTURE0})}}if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw"Incomplete frame buffer object.";b.bindFramebuffer(b.FRAMEBUFFER,null)}d.prototype.bind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.handle)};d.prototype.unbind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,null)};
d.prototype.bindTexture=function(b,c){var d=this.gl,a=this.tex_attachments[b];if(c!==void 0)a.unit=d.TEXTURE0+c;d.activeTexture(a.unit);d.bindTexture(a.target,a.handle)};d.prototype.unbindTexture=function(b){var c=this.gl,b=this.tex_attachments[b];c.activeTexture(b.unit);c.bindTexture(b.target,null)};return d}();
Embr.PingPong=function(){function d(b,c,d,a){this.wbuffer=new Embr.Fbo(b,c,d,a);this.rbuffer=new Embr.Fbo(b,c,d,a);this.swap()}d.prototype.swap=function(){var b=this.wbuffer;this.wbuffer=this.rbuffer;this.rbuffer=b};d.prototype.bind=function(){this.wbuffer.bind()};d.prototype.unbind=function(){this.wbuffer.unbind()};d.prototype.bindTexture=function(){this.rbuffer.bindTexture.apply(this.rbuffer,arguments)};d.prototype.unbindTexture=function(){this.rbuffer.unbindTexture.apply(this.rbuffer,arguments)};
return d}();
Embr.Program=function(){function d(b){for(var c,d=/^ *#include +"([\w\-\.]+)"/gm;c=d.exec(b);){var f=c[1];if(f in a)f=a[f],b=b.replace(RegExp(c[0]),f),d.lastIndex=c.index+f.length}return b}function b(a,b){function k(b,c){switch(b){case a.BOOL:case a.INT:case a.SAMPLER_2D:case a.SAMPLER_CUBE:return function(b){a.uniform1i(c,b);return this};case a.FLOAT:return function(b){a.uniform1f(c,b);return this};case a.FLOAT_VEC2:return function(b){a.uniform2f(c,b.x,b.y)};case a.FLOAT_VEC3:return function(b){a.uniform3f(c,b.x,
b.y,b.z)};case a.FLOAT_VEC4:return function(b){a.uniform4f(c,b.x,b.y,b.z,b.w)};case a.FLOAT_MAT4:return function(b){a.uniformMatrix4fv(c,!1,b.toFloat32Array())}}return function(){throw"Unknown uniform type: "+b;}}this.gl=a;var b=d(b),g=this.vshader=a.createShader(a.VERTEX_SHADER);a.shaderSource(g,c+b);a.compileShader(g);if(a.getShaderParameter(g,a.COMPILE_STATUS)!==!0)throw a.getShaderInfoLog(g);var p=this.fshader=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(p,f+b);a.compileShader(p);if(a.getShaderParameter(p,
a.COMPILE_STATUS)!==!0)throw a.getShaderInfoLog(p);var i=this.handle=a.createProgram();a.attachShader(i,g);a.attachShader(i,p);a.linkProgram(i);if(a.getProgramParameter(i,a.LINK_STATUS)!==!0)throw a.getProgramInfoLog(i);for(var j=a.getProgramParameter(i,a.ACTIVE_UNIFORMS),g=0;g<j;g++){var p=a.getActiveUniform(i,g),h=a.getUniformLocation(i,p.name);this["set_"+p.name]=k(p.type,h);this["loc_"+p.name]=h}j=a.getProgramParameter(i,a.ACTIVE_ATTRIBUTES);for(g=0;g<j;g++)p=a.getActiveAttrib(i,g),h=a.getAttribLocation(i,
p.name),this["loc_"+p.name]=h}var c="#ifdef GL_ES\nprecision highp float;\n#endif\n#define VERTEX\n",f="#ifdef GL_ES\nprecision highp float;\n#endif\n#define FRAGMENT\n",a={};b.prototype.use=function(){this.gl.useProgram(this.handle)};b.include=function(b,c){a[b]=c};return b}();
Embr.Vbo=function(){function d(b,c,d,a){function e(c,e,g){var h=b.createBuffer();b.bindBuffer(e,h);b.bufferData(e,g,d);Embr.Util.glCheckErr(b,"Error adding attribute '"+c+"'");var l=a[c],n=l.size!==void 0?l.size:1,m=l.location;l.location===void 0&&e===b.ARRAY_BUFFER&&(m=k++);J.attributes[c]={buffer:h,target:e,size:n,length:Math.floor(g.length/n),location:m}}this.gl=b;this.type=c;this.usage=d;this.attributes={};var J=this,k=0,g;for(g in a)c=a[g],g==="index"?e(g,b.ELEMENT_ARRAY_BUFFER,new Uint16Array(c.data)):
e(g,b.ARRAY_BUFFER,new Float32Array(c.data));if(!this.attributes.index)for(g in this.length=Number.MAX_VALUE,this.attributes)this.length=Math.min(this.length,this.attributes[g].length)}d.prototype.draw=function(){var b=this.gl,c;for(c in this.attributes){var d=this.attributes[c];d.target==b.ARRAY_BUFFER&&(b.bindBuffer(d.target,d.buffer),b.vertexAttribPointer(d.location,d.size,b.FLOAT,!1,0,0),b.enableVertexAttribArray(d.location))}(c=this.attributes.index)?(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.buffer),
b.drawElements(this.type,c.length,b.UNSIGNED_SHORT,0)):b.drawArrays(this.type,0,this.length)};d.prototype.destroy=function(){for(var b=this.gl,c=attributes.length;--c>=0;)b.deleteBuffer(attributes[c])};d.makePlane=function(b,c,d,a,e){return new Embr.Vbo(b,b.TRIANGLE_STRIP,b.STATIC_DRAW,{position:{data:[c,d,0,c,e,0,a,d,0,a,e,0],size:3},texcoord:{data:[0,0,0,1,1,0,1,1],size:2}})};d.makeCube=function(b,c,d,a){return new Embr.Vbo(b,b.TRIANGLES,b.STATIC_DRAW,{position:{data:[c,d,a,c,-d,a,c,-d,-a,c,d,-a,
c,d,a,c,d,-a,-c,d,-a,-c,d,a,c,d,a,-c,d,a,-c,-d,a,c,-d,a,-c,d,a,-c,d,-a,-c,-d,-a,-c,-d,a,-c,-d,-a,c,-d,-a,c,-d,a,-c,-d,a,c,-d,-a,-c,-d,-a,-c,d,-a,c,d,-a],size:3},normal:{data:[1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],size:3},texcoord:{data:[0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1],size:2},index:{data:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,
10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}})};return d}();
