var Embr=Embr!==void 0?Embr:{};
Embr.run=function(c,b){var d=null;try{d=c.getContext("experimental-webgl")}catch(f){console.error(f)}if(d){console.log(["EMBR made a GL context!",d.getParameter(d.VERSION),d.getParameter(d.VENDOR),d.getParameter(d.RENDERER),d.getParameter(d.SHADING_LANGUAGE_VERSION)].join(" | "));b.gl=d;b.width=c.width;b.height=c.height;var a=null;b.framerate=function(e){a!==null&&clearInterval(a);e!==0&&(a=setInterval(function(){b._draw()},1E3/e))};if("init"in b)try{b.init()}catch(e){console.error("Exception caught in init: "+e)}if("draw"in
b)var G=b.draw;var i=0,g=Date.now();b._draw=function(){if(G!==null){b.frameid=i;b.frametime=(Date.now()-g)/1E3;try{b.draw()}catch(a){console.error("Exception caught in draw: "+a)}i++}};b._draw();return b}};
(function(){function c(a,e,b){this.x=a;this.y=e;this.z=b}function b(a,e){this.x=a;this.y=e}function d(a,e,b,d){this.x=a;this.y=e;this.z=b;this.w=d}function f(){this.reset()}c.prototype.set=function(a,e,b){this.x=a;this.y=e;this.z=b;return this};c.prototype.setVec3=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};c.prototype.cross2=function(a,e){var b=a.x,d=a.y,g=a.z,f=e.x,c=e.y,k=e.z;this.x=d*k-g*c;this.y=g*f-b*k;this.z=b*c-d*f;return this};c.prototype.cross=function(a){return this.cross2(this,
a)};c.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};c.prototype.add2=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;this.z=a.z+e.z;return this};c.prototype.added2=function(a,e){return new c(a.x+e.x,a.y+e.y,a.z+e.z)};c.prototype.add=function(a){return this.add2(this,a)};c.prototype.added=function(a){return this.added2(this,a)};c.prototype.sub2=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;this.z=a.z-e.z;return this};c.prototype.subbed2=function(a,e){return new c(a.x-e.x,a.y-e.y,a.z-
e.z)};c.prototype.sub=function(a){return this.sub2(this,a)};c.prototype.subbed=function(a){return this.subbed2(this,a)};c.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};c.prototype.scaled=function(a){return new c(this.x*a,this.y*a,this.z*a)};c.prototype.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;this.z+=(a.z-this.z)*e;return this};c.prototype.lerped=function(a,e){return new c(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e,this.z+(a.z-this.z)*e)};c.prototype.length=
function(){var a=this.x,e=this.y,b=this.z;return Math.sqrt(a*a+e*e+b*b)};c.prototype.lengthSquared=function(){var a=this.x,e=this.y,b=this.z;return a*a+e*e+b*b};c.prototype.normalize=function(){return this.scale(1/this.length())};c.prototype.normalized=function(){return this.dup().normalize()};c.prototype.dup=function(){return new c(this.x,this.y,this.z)};c.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z};b.prototype.set=function(a,e){this.x=a;this.y=e;return this};
b.prototype.setVec2=function(a){this.x=a.x;this.y=a.y;return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.add2=function(a,e){this.x=a.x+e.x;this.y=a.y+e.y;return this};b.prototype.added2=function(a,e){return new b(a.x+e.x,a.y+e.y)};b.prototype.add=function(a){return this.add2(this,a)};b.prototype.added=function(a){return this.added2(this,a)};b.prototype.sub2=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y;return this};b.prototype.subbed2=function(a,e){return new b(a.x-e.x,
a.y-e.y)};b.prototype.sub=function(a){return this.sub2(this,a)};b.prototype.subbed=function(a){return this.subbed2(this,a)};b.prototype.scale=function(a){this.x*=a;this.y*=a;return this};b.prototype.scaled=function(a){return new b(this.x*a,this.y*a)};b.prototype.lerp=function(a,e){this.x+=(a.x-this.x)*e;this.y+=(a.y-this.y)*e;return this};b.prototype.lerped=function(a,e){return new b(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e)};b.prototype.length=function(){var a=this.x,e=this.y;return Math.sqrt(a*
a+e*e)};b.prototype.lengthSquared=function(){var a=this.x,e=this.y;return a*a+e*e};b.prototype.normalize=function(){return this.scale(1/this.length())};b.prototype.normalized=function(){return this.dup().normalize()};b.prototype.dup=function(){return new b(this.x,this.y)};b.prototype.debugString=function(){return"x: "+this.x+" y: "+this.y};d.prototype.set=function(a,e,b,d){this.x=a;this.y=e;this.z=b;this.w=d;return this};d.prototype.setVec4=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;
return this};d.prototype.dup=function(){return new d(this.x,this.y,this.z,this.w)};d.prototype.toVec3=function(){return new c(this.x,this.y,this.z)};f.prototype.set4x4r=function(a,e,b,d,g,f,c,k,h,r,n,l,q,m,o,t){this.a11=a;this.a12=e;this.a13=b;this.a14=d;this.a21=g;this.a22=f;this.a23=c;this.a24=k;this.a31=h;this.a32=r;this.a33=n;this.a34=l;this.a41=q;this.a42=m;this.a43=o;this.a44=t;return this};f.prototype.reset=function(){this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};f.prototype.mul2=
function(a,e){var b=a.a11,d=a.a12,g=a.a13,f=a.a14,c=a.a21,k=a.a22,h=a.a23,r=a.a24,n=a.a31,l=a.a32,q=a.a33,m=a.a34,o=a.a41,t=a.a42,s=a.a43,v=a.a44,u=e.a11,z=e.a12,x=e.a13,C=e.a14,D=e.a21,y=e.a22,E=e.a23,A=e.a24,B=e.a31,F=e.a32,w=e.a33,H=e.a34,I=e.a41,J=e.a42,K=e.a43,L=e.a44;this.a11=b*u+d*D+g*B+f*I;this.a12=b*z+d*y+g*F+f*J;this.a13=b*x+d*E+g*w+f*K;this.a14=b*C+d*A+g*H+f*L;this.a21=c*u+k*D+h*B+r*I;this.a22=c*z+k*y+h*F+r*J;this.a23=c*x+k*E+h*w+r*K;this.a24=c*C+k*A+h*H+r*L;this.a31=n*u+l*D+q*B+m*I;this.a32=
n*z+l*y+q*F+m*J;this.a33=n*x+l*E+q*w+m*K;this.a34=n*C+l*A+q*H+m*L;this.a41=o*u+t*D+s*B+v*I;this.a42=o*z+t*y+s*F+v*J;this.a43=o*x+t*E+s*w+v*K;this.a44=o*C+t*A+s*H+v*L;return this};f.prototype.mul=function(a){return this.mul2(this,a)};f.prototype.mul4x4r=function(a,e,b,d,g,f,c,k,h,r,n,l,q,m,o,t){var s=this.a11,v=this.a12,u=this.a13,z=this.a14,x=this.a21,C=this.a22,D=this.a23,y=this.a24,E=this.a31,A=this.a32,B=this.a33,F=this.a34,w=this.a41,H=this.a42,I=this.a43,J=this.a44;this.a11=s*a+v*g+u*h+z*q;this.a12=
s*e+v*f+u*r+z*m;this.a13=s*b+v*c+u*n+z*o;this.a14=s*d+v*k+u*l+z*t;this.a21=x*a+C*g+D*h+y*q;this.a22=x*e+C*f+D*r+y*m;this.a23=x*b+C*c+D*n+y*o;this.a24=x*d+C*k+D*l+y*t;this.a31=E*a+A*g+B*h+F*q;this.a32=E*e+A*f+B*r+F*m;this.a33=E*b+A*c+B*n+F*o;this.a34=E*d+A*k+B*l+F*t;this.a41=w*a+H*g+I*h+J*q;this.a42=w*e+H*f+I*r+J*m;this.a43=w*b+H*c+I*n+J*o;this.a44=w*d+H*k+I*l+J*t;return this};f.prototype.rotate=function(a,e,b,d){var g=Math.sin(a),a=Math.cos(a);this.mul4x4r(e*e*(1-a)+a,e*b*(1-a)-d*g,e*d*(1-a)+b*g,
0,b*e*(1-a)+d*g,b*b*(1-a)+a,b*d*(1-a)-e*g,0,e*d*(1-a)-b*g,b*d*(1-a)+e*g,d*d*(1-a)+a,0,0,0,0,1);return this};f.prototype.translate=function(a,e,b){this.mul4x4r(1,0,0,a,0,1,0,e,0,0,1,b,0,0,0,1);return this};f.prototype.scale=function(a,e,b){this.mul4x4r(a,0,0,0,0,e,0,0,0,0,b,0,0,0,0,1);return this};f.prototype.lookAt=function(a,e,b,d,g,f,j,k,h){d=(new c(a-d,e-g,b-f)).normalize();j=(new c(j,k,h)).cross(d).normalize();k=d.dup().cross(j).normalize();this.mul4x4r(j.x,j.y,j.z,0,k.x,k.y,k.z,0,d.x,d.y,d.z,
0,0,0,0,1);this.translate(-a,-e,-b);return this};f.prototype.frustum=function(a,e,b,d,f,c){this.mul4x4r((f+f)/(e-a),0,(e+a)/(e-a),0,0,(f+f)/(d-b),(d+b)/(d-b),0,0,0,(c+f)/(f-c),2*c*f/(f-c),0,0,-1,0);return this};f.prototype.perspective=function(a,e,b,d){a=1/Math.tan(a*Math.PI/360);this.mul4x4r(a/e,0,0,0,0,a,0,0,0,0,(d+b)/(b-d),2*b*d/(b-d),0,0,-1,0);return this};f.prototype.ortho=function(a,e,b,d,f,c){this.mul4x4r(2/(e-a),0,0,(e+a)/(a-e),0,2/(d-b),0,(d+b)/(b-d),0,0,2/(f-c),(c+f)/(f-c),0,0,0,1);return this};
f.prototype.invert=function(){var a=this.a11,e=this.a12,b=this.a13,d=this.a14,f=this.a21,c=this.a22,j=this.a23,k=this.a24,h=this.a31,r=this.a32,n=this.a33,l=this.a34,q=this.a41,m=this.a42,o=this.a43,t=this.a44,s=a*c-e*f,v=a*j-b*f,u=a*k-d*f,z=e*j-b*c,x=e*k-d*c,C=b*k-d*j,D=h*m-r*q,y=h*o-n*q,E=h*t-l*q,A=r*o-n*m,B=r*t-l*m,F=n*t-l*o,w=1/(s*F-v*B+u*A+z*E-x*y+C*D);this.a11=(+c*F-j*B+k*A)*w;this.a12=(-e*F+b*B-d*A)*w;this.a13=(+m*C-o*x+t*z)*w;this.a14=(-r*C+n*x-l*z)*w;this.a21=(-f*F+j*E-k*y)*w;this.a22=(+a*
F-b*E+d*y)*w;this.a23=(-q*C+o*u-t*v)*w;this.a24=(+h*C-n*u+l*v)*w;this.a31=(+f*B-c*E+k*D)*w;this.a32=(-a*B+e*E-d*D)*w;this.a33=(+q*x-m*u+t*s)*w;this.a34=(-h*x+r*u-l*s)*w;this.a41=(-f*A+c*y-j*D)*w;this.a42=(+a*A-e*y+b*D)*w;this.a43=(-q*z+m*v-o*s)*w;this.a44=(+h*z-r*v+n*s)*w;return this};f.prototype.transpose=function(){var a=this.a12,e=this.a13,b=this.a14,d=this.a21,f=this.a22,c=this.a23,j=this.a24,k=this.a31,h=this.a32,r=this.a33,n=this.a34,l=this.a41,q=this.a42,m=this.a43,o=this.a44;this.a11=this.a11;
this.a12=d;this.a13=k;this.a14=l;this.a21=a;this.a22=f;this.a23=h;this.a24=q;this.a31=e;this.a32=c;this.a33=r;this.a34=m;this.a41=b;this.a42=j;this.a43=n;this.a44=o;return this};f.prototype.mulVec3=function(a){var e=a.x,b=a.y,a=a.z;return new c(this.a14+this.a11*e+this.a12*b+this.a13*a,this.a24+this.a21*e+this.a22*b+this.a23*a,this.a34+this.a31*e+this.a32*b+this.a33*a)};f.prototype.mulVec4=function(a){var e=a.x,b=a.y,f=a.z,a=a.w;return new d(this.a14*a+this.a11*e+this.a12*b+this.a13*f,this.a24*a+
this.a21*e+this.a22*b+this.a23*f,this.a34*a+this.a31*e+this.a32*b+this.a33*f,this.a44*a+this.a41*e+this.a42*b+this.a43*f)};f.prototype.dup=function(){var a=new f;a.set4x4r(this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44);return a};f.prototype.toFloat32Array=function(){return new Float32Array([this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,
this.a24,this.a34,this.a44])};f.prototype.debugString=function(){for(var a=[this.a11,this.a12,this.a13,this.a14,this.a21,this.a22,this.a23,this.a24,this.a31,this.a32,this.a33,this.a34,this.a41,this.a42,this.a43,this.a44],b=[0,0,0,0],d=0;d<16;++d){a[d]+="";var f=a[d].length,c=d&3;b[c]<f&&(b[c]=f)}c="";for(d=0;d<16;++d){f=a[d].length;for(f=b[d&3]-f;f--;)c+=" ";c+=a[d]+((d&3)===3?"\n":"  ")}return c};Embr.Vec2=b;Embr.Vec3=c;Embr.Vec4=d;Embr.Mat4=f})();
Embr.Util=function(){var c=null;return{glCheckErr:function(b,d){var f=b.getError();if(f!==b.NO_ERROR){if(c===null){c={};for(var a in b)typeof b[a]=="number"&&(c[b[a]]=a)}throw d+" ("+c[f]+")";}}}}();
Embr.Math=function(){var c=Math.PI*2;return{kPI:Math.PI,kPI2:Math.PI/2,kPI4:Math.PI/4,k2PI:c,rand:function(b,d){return b+Math.random()*(d-b)},randSym:function(b){return b*2*Math.random()-b},randVec3:function(b){var d=Math.random()*c,f=Math.random()*2-1,a=Math.sqrt(1-f*f);return new Embr.Vec3(a*Math.cos(d)*b,a*Math.sin(d)*b,f*b)}}}();
Embr.Quat=function(){function c(){this.reset()}var b=Math.pow(2,-24);c.prototype.set=function(b,f,a,e){this.x=b;this.y=f;this.z=a;this.w=e;return this};c.prototype.reset=function(){return this.set(0,0,0,1)};c.prototype.length=function(){var b=this.x,f=this.y,a=this.z,e=this.w;return Math.sqrt(b*b+f*f+a*a+e*e)};c.prototype.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w};c.prototype.mult2=function(b,f){var a=b.x,e=b.y,c=b.z,i=b.w,g=f.x,p=f.y,j=f.z,k=f.w;this.x=k*a+g*i+p*c-j*e;this.y=
k*e+p*i+j*a-g*c;this.z=k*c+j*i+g*e-p*a;this.w=k*i-g*a-p*e-j*c;return this};c.prototype.mult=function(b){return this.mult2(this,b)};c.prototype.mult4=function(b,f,a,e){var c=this.x,i=this.y,g=this.z,p=this.w;this.x=e*c+b*p+f*g-a*i;this.y=e*i+f*p+a*c-b*g;this.z=e*g+a*p+b*i-f*c;this.w=e*p-b*c-f*i-a*g;return this};c.prototype.normalize=function(){var d=this.length();d>b&&(this.x/=d,this.y/=d,this.z/=d,this.w/=d);return this};c.prototype.rotate=function(d,f,a,e){var c=Math.sqrt(f*f+a*a+e*e);if(c>b){d/=
2;var i=Math.sin(d);this.mult4(f/c*i,a/c*i,e/c*i,Math.cos(d))}return this};c.prototype.toMat4=function(){var b=this.x+this.x,f=this.y+this.y,a=this.z+this.z,e=this.w*b,c=this.w*f,i=this.w*a;b*=this.x;var g=this.x*f,p=this.x*a;f*=this.y;var j=this.y*a;a*=this.z;return(new Embr.Mat4).set4x4r(1-(f+a),g-i,p+c,0,g+i,1-(b+a),j-e,0,p-c,j+e,1-(b+f),0,0,0,0,1)};c.prototype.dup=function(){return(new c).set(this.x,this.y,this.z,this.w)};return c}();
Embr.Texture=function(){function c(b,d,f,a,e){this.width=d;this.height=heigth;e===void 0&&(e={});var a=e.filter_min!==void 0?e.filter_min:b.NEAREST,c=e.filter_mag!==void 0?e.filter_mag:b.NEAREST,i=e.wrap_s!==void 0?e.wrap_s:b.CLAMP_TO_EDGE,g=e.wrap_t!==void 0?e.wrap_t:b.CLAMP_TO_EDGE;this.target=e.target!==void 0?e.target:b.TEXTURE_2D;this.format=e.format!==void 0?e.format:b.RGBA;this.formati=e.formati!==void 0?e.formati:b.RGBA;this.type=e.type!==void 0?e.type:b.UNSIGNED_BYTE;this.handle=b.createTexture();
b.bindTexture(this.target,this.handle);b.texImage2D(target,0,this.formati,d,f,0,this.format,type,tex_data);b.texParameteri(this.target,b.TEXTURE_MIN_FILTER,a);b.texParameteri(this.target,b.TEXTURE_MAG_FILTER,c);b.texParameteri(this.target,b.TEXTURE_WRAP_S,i);b.texParameteri(this.target,b.TEXTURE_WRAP_T,g)}c.prototype.bind=function(b){var d=this.gl;b!==void 0&&d.activeTexture(d.TEXTURE0+b);d.bindTexture(this.target,obj)};c.prototype.unbind=function(b){var d=this.gl;b!==void 0&&d.activeTexture(d.TEXTURE0+
b);d.bindTexture(this.target,null)};c.prototype.update=function(b){var d=this.gl;d.bindTexture(this.target,this.handle);d.texSubImage2D(this.target,0,0,0,this.width,this.height,this.format,this.type,b)};return c}();
Embr.Fbo=function(){function c(b,d,c,a){this.gl=b;this.width=d;this.height=c;this.tex_attachments=[];this.render_attachments=[];this.handle=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,this.handle);for(var e=0,G=a.length,i=0;e<G;e++){var g=a[e],p=g.target!==void 0?g.target:b.TEXTURE_2D,j=g.formati!==void 0?g.formati:b.RGBA,k=g.attach!==void 0?g.attach:b.COLOR_ATTACHMENT0+i++;if(p==b.RENDERBUFFER){var h=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,h);b.renderbufferStorage(p,j,
d,c);b.framebufferRenderbuffer(b.FRAMEBUFFER,k,p,h);this.render_attachments.push({handle:h})}else{var h=g.format!==void 0?g.format:b.RGBA,r=g.type!==void 0?g.type:b.UNSIGNED_BYTE,n=g.filter_min!==void 0?g.filter_min:b.NEAREST,l=g.filter_mag!==void 0?g.filter_mag:b.NEAREST,q=g.wrap_s!==void 0?g.wrap_s:b.CLAMP_TO_EDGE,g=g.wrap_t!==void 0?g.wrap_t:b.CLAMP_TO_EDGE,m=b.createTexture();b.bindTexture(p,m);b.texImage2D(p,0,j,d,c,0,h,r,null);b.texParameteri(p,b.TEXTURE_MIN_FILTER,n);b.texParameteri(p,b.TEXTURE_MAG_FILTER,
l);b.texParameteri(p,b.TEXTURE_WRAP_S,q);b.texParameteri(p,b.TEXTURE_WRAP_T,g);b.framebufferTexture2D(b.FRAMEBUFFER,k,p,m,0);this.tex_attachments.push({handle:m,target:p,unit:b.TEXTURE0})}}if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw"Incomplete frame buffer object.";b.bindFramebuffer(b.FRAMEBUFFER,null)}c.prototype.bind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.handle)};c.prototype.unbind=function(){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,null)};
c.prototype.bindTexture=function(b,d){var c=this.gl,a=this.tex_attachments[b];if(d!==void 0)a.unit=c.TEXTURE0+d;c.activeTexture(a.unit);c.bindTexture(a.target,a.handle)};c.prototype.unbindTexture=function(b){var d=this.gl,b=this.tex_attachments[b];d.activeTexture(b.unit);d.bindTexture(b.target,null)};return c}();
Embr.PingPong=function(){function c(b,d,c,a){this.wbuffer=new Embr.Fbo(b,d,c,a);this.rbuffer=new Embr.Fbo(b,d,c,a);this.swap()}c.prototype.swap=function(){var b=this.wbuffer;this.wbuffer=this.rbuffer;this.rbuffer=b};c.prototype.bind=function(){this.wbuffer.bind()};c.prototype.unbind=function(){this.wbuffer.unbind()};c.prototype.bindTexture=function(){this.rbuffer.bindTexture.apply(this.rbuffer,arguments)};c.prototype.unbindTexture=function(){this.rbuffer.unbindTexture.apply(this.rbuffer,arguments)};
return c}();
Embr.Program=function(){function c(b){for(var d,c=/^ *#include +"([\w\-\.]+)"/gm;d=c.exec(b);){var f=d[1];if(f in a)f=a[f],b=b.replace(RegExp(d[0]),f),c.lastIndex=d.index+f.length}return b}function b(a,b){function i(b,d){switch(b){case a.BOOL:case a.INT:case a.SAMPLER_2D:case a.SAMPLER_CUBE:return function(b){a.uniform1i(d,b);return this};case a.FLOAT:return function(b){a.uniform1f(d,b);return this};case a.FLOAT_VEC2:return function(b){a.uniform2f(d,b.x,b.y)};case a.FLOAT_VEC3:return function(b){a.uniform3f(d,b.x,
b.y,b.z)};case a.FLOAT_VEC4:return function(b){a.uniform4f(d,b.x,b.y,b.z,b.w)};case a.FLOAT_MAT4:return function(b){a.uniformMatrix4fv(d,!1,b.toFloat32Array())}}return function(){throw"Unknown uniform type: "+b;}}this.gl=a;var b=c(b),g=this.vshader=a.createShader(a.VERTEX_SHADER);a.shaderSource(g,d+b);a.compileShader(g);if(a.getShaderParameter(g,a.COMPILE_STATUS)!==!0)throw a.getShaderInfoLog(g);var p=this.fshader=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(p,f+b);a.compileShader(p);if(a.getShaderParameter(p,
a.COMPILE_STATUS)!==!0)throw a.getShaderInfoLog(p);var j=this.handle=a.createProgram();a.attachShader(j,g);a.attachShader(j,p);a.linkProgram(j);if(a.getProgramParameter(j,a.LINK_STATUS)!==!0)throw a.getProgramInfoLog(j);for(var k=a.getProgramParameter(j,a.ACTIVE_UNIFORMS),g=0;g<k;g++){var p=a.getActiveUniform(j,g),h=a.getUniformLocation(j,p.name);this["set_"+p.name]=i(p.type,h);this["loc_"+p.name]=h}k=a.getProgramParameter(j,a.ACTIVE_ATTRIBUTES);for(g=0;g<k;g++)p=a.getActiveAttrib(j,g),h=a.getAttribLocation(j,
p.name),this["loc_"+p.name]=h}var d="#ifdef GL_ES\nprecision highp float;\n#endif\n#define VERTEX\n",f="#ifdef GL_ES\nprecision highp float;\n#endif\n#define FRAGMENT\n",a={};b.prototype.use=function(){this.gl.useProgram(this.handle)};b.include=function(b,d){a[b]=d};return b}();
Embr.Vbo=function(){function c(b,d,c,a){function e(d,e,j){var k=b.createBuffer();b.bindBuffer(e,k);b.bufferData(e,j,c);Embr.Util.glCheckErr(b,"Error adding attribute '"+d+"'");var h=a[d],i=h.size!==void 0?h.size:1;G.attributes[d]={buffer:k,target:e,size:i,length:Math.floor(j.length/i),location:h.location}}this.gl=b;this.type=d;this.usage=c;this.attributes={};var G=this,i;for(i in a)d=a[i],i=="indices"?e(i,b.ELEMENT_ARRAY_BUFFER,new Uint16Array(d.data)):e(i,b.ARRAY_BUFFER,new Float32Array(d.data));
if(!this.attributes.indices)for(i in this.length=Number.MAX_VALUE,this.attributes)this.length=Math.min(this.length,this.attributes[i].length)}c.prototype.draw=function(){var b=this.gl,d;for(d in this.attributes){var c=this.attributes[d];c.target==b.ARRAY_BUFFER&&(b.bindBuffer(c.target,c.buffer),b.vertexAttribPointer(c.location,c.size,b.FLOAT,!1,0,0),b.enableVertexAttribArray(c.location))}(d=this.attributes.indices)?(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.buffer),b.drawElements(this.type,d.length,b.UNSIGNED_SHORT,
0)):b.drawArrays(this.type,0,this.length);Embr.Util.glCheckErr(b,"Error drawing Vbo")};c.prototype.destroy=function(){for(var b=this.gl,d=attributes.length;--d>=0;)b.deleteBuffer(attributes[d])};c.makePlane=function(b,d,c,a,e,G,i){return new Embr.Vbo(b,b.TRIANGLE_STRIP,b.STATIC_DRAW,{vertices:{data:[d,c,0,d,e,0,a,c,0,a,e,0],size:3,location:G},texcoords:{data:[0,0,0,1,1,0,1,1],size:2,location:i}})};c.makeCube=function(b,d,c,a,e,G,i){return new Embr.Vbo(b,b.TRIANGLES,b.STATIC_DRAW,{vertices:{data:[d,
c,a,d,-c,a,d,-c,-a,d,c,-a,d,c,a,d,c,-a,-d,c,-a,-d,c,a,d,c,a,-d,c,a,-d,-c,a,d,-c,a,-d,c,a,-d,c,-a,-d,-c,-a,-d,-c,a,-d,-c,-a,d,-c,-a,d,-c,a,-d,-c,a,d,-c,-a,-d,-c,-a,-d,c,-a,d,c,-a],size:3,location:e},normals:{data:[1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],size:3,location:G},texcoords:{data:[0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1],
size:2,location:i},indices:{data:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}})};return c}();
Embr.noise=function(){for(var c=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,
73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,
222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],d=Array(512),f=0;f<512;f++)d[f]=b[f&255];var a=0.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,G=1/3,i=1/6;return{sn2:function(b,f){var j,k,h;h=(b+f)*a;var i=Math.floor(b+h),n=Math.floor(f+h);h=(i+n)*e;j=b-(i-h);var l=f-(n-h),q,m;j>l?(q=1,m=0):(q=0,m=1);k=j-q+e;var o=l-m+e;h=j-1+2*e;var t=l-1+2*e,s=i&255;n&=255;i=d[s+d[n]]%12;q=d[s+q+d[n+m]]%12;m=d[s+1+d[n+1]]%12;s=0.5-j*j-l*l;s<0?j=0:(s*=s,j=s*s*(c[i][0]*j+c[i][1]*l));l=0.5-k*k-o*o;l<0?k=0:(l*=
l,k=l*l*(c[q][0]*k+c[q][1]*o));o=0.5-h*h-t*t;o<0?h=0:(o*=o,h=o*o*(c[m][0]*h+c[m][1]*t));return 70*(j+k+h)},sn3:function(a,b,e){var f,h,r=(a+b+e)*G,n=Math.floor(a+r),l=Math.floor(b+r),q=Math.floor(e+r),r=(n+l+q)*i;f=a-(n-r);h=b-(l-r);var m=e-(q-r),o,t,s,v,u,z;f>=h?h>=m?(o=1,s=t=0,u=v=1,z=0):(f>=m?(o=1,s=t=0):(t=o=0,s=1),v=1,u=0,z=1):h<m?(t=o=0,s=1,v=0,z=u=1):f<m?(o=0,t=1,v=s=0,z=u=1):(o=0,t=1,s=0,u=v=1,z=0);var x=f-o+i,C=h-t+i,D=m-s+i,a=f-v+2*i,y=h-u+2*i,E=m-z+2*i,e=f-1+3*i,b=h-1+3*i,r=m-1+3*i;n&=
255;var A=l&255,B=q&255,l=d[n+d[A+d[B]]]%12,q=d[n+o+d[A+t+d[B+s]]]%12;v=d[n+v+d[A+u+d[B+z]]]%12;n=d[n+1+d[A+1+d[B+1]]]%12;u=0.6-f*f-h*h-m*m;u<0?f=0:(u*=u,f=u*u*(c[l][0]*f+c[l][1]*h+c[l][2]*m));h=0.6-x*x-C*C-D*D;h<0?h=0:(h*=h,h=h*h*(c[q][0]*x+c[q][1]*C+c[q][2]*D));x=0.6-a*a-y*y-E*E;x<0?a=0:(x*=x,a=x*x*(c[v][0]*a+c[v][1]*y+c[v][2]*E));y=0.6-e*e-b*b-r*r;y<0?e=0:(y*=y,e=y*y*(c[n][0]*e+c[n][1]*b+c[n][2]*r));return 32*(f+h+a+e)}}}();
